<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ç¬”è®°å†…å®¹æ¥è‡ªäºStanford CS106Lçš„2019å¹´ç§‹å­£è§†é¢‘ï¼Œ[é“¾æ¥](CS 106L Fall 2020 - Guest Lecture: Template Metaprogramming - YouTube)ã€‚ ä¸‹åŠéƒ¨åˆ†ä¸»è¦æ˜¯C++çš„ç±»ç›¸å…³æ¦‚å¿µä»¥åŠC++11ä¹‹åçš„ä¸€äº›æ–°ç‰¹æ€§ï¼Œå­¦ä¹ å¦‚ä½•è¿›è¡Œç°ä»£çš„C++ç¼–ç¨‹ã€‚ Lecture 10: Classes and Constanté¢å‘å¯¹è±¡æ¦‚è§ˆåœ¨CS1">
<meta property="og:type" content="article">
<meta property="og:title" content="Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†">
<meta property="og:url" content="https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/index.html">
<meta property="og:site_name" content="crownZ&#39;s Blog">
<meta property="og:description" content="ç¬”è®°å†…å®¹æ¥è‡ªäºStanford CS106Lçš„2019å¹´ç§‹å­£è§†é¢‘ï¼Œ[é“¾æ¥](CS 106L Fall 2020 - Guest Lecture: Template Metaprogramming - YouTube)ã€‚ ä¸‹åŠéƒ¨åˆ†ä¸»è¦æ˜¯C++çš„ç±»ç›¸å…³æ¦‚å¿µä»¥åŠC++11ä¹‹åçš„ä¸€äº›æ–°ç‰¹æ€§ï¼Œå­¦ä¹ å¦‚ä½•è¿›è¡Œç°ä»£çš„C++ç¼–ç¨‹ã€‚ Lecture 10: Classes and Constanté¢å‘å¯¹è±¡æ¦‚è§ˆåœ¨CS1">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/crownz-sec/Blog_Source@master/Stanford-CS106L/OOP-C++.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/crownz-sec/Blog_Source@master/Stanford-CS106L/swap.gif">
<meta property="article:published_time" content="2022-07-31T04:00:00.000Z">
<meta property="article:modified_time" content="2022-07-31T04:05:23.993Z">
<meta property="article:author" content="crownZ">
<meta property="article:tag" content="å­¦ä¹ ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/crownz-sec/Blog_Source@master/Stanford-CS106L/OOP-C++.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.0.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/07/31/Stanford%20CS106L%202019%20Note-Top%20half/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&text=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&is_video=false&description=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†&body=Check out this article: https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&name=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&t=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-10-Classes-and-Constant"><span class="toc-number">1.</span> <span class="toc-text">Lecture 10: Classes and Constant</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%A6%82%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">é¢å‘å¯¹è±¡æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-%E5%8F%98%E9%87%8F"><span class="toc-number">1.2.</span> <span class="toc-text">const-å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-%E6%8C%87%E9%92%88"><span class="toc-number">1.3.</span> <span class="toc-text">const-æŒ‡é’ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text">const-è¿­ä»£å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const%E5%9B%9E%E9%A1%BE"><span class="toc-number">1.5.</span> <span class="toc-text">constå›é¡¾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-11-Operators"><span class="toc-number">2.</span> <span class="toc-text">Lecture 11: Operators</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD%E7%9A%84%E4%B8%80%E8%88%AC%E7%BB%8F%E9%AA%8C%E6%B3%95%E5%88%99"><span class="toc-number">2.1.</span> <span class="toc-text">é‡è½½çš„ä¸€èˆ¬ç»éªŒæ³•åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Principle-of-Least-Astonishment-POLA"><span class="toc-number">2.2.</span> <span class="toc-text">Principle of Least Astonishment(POLA)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-12-Special-Member-Functions"><span class="toc-number">3.</span> <span class="toc-text">Lecture 12: Special Member Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">3.0.1.</span> <span class="toc-text">æ„é€ å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-operations"><span class="toc-number">3.1.</span> <span class="toc-text">copy operations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-elision%E5%92%8CRVO%EF%BC%88return-value-optimization%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">copy elisionå’ŒRVOï¼ˆreturn value optimizationï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-13-Move-Semantics"><span class="toc-number">4.</span> <span class="toc-text">Lecture 13: Move Semantics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#std-vector-lt-T-Allocator-gt-emplace-back"><span class="toc-number">4.1.</span> <span class="toc-text">std: :vector&lt;T,Allocator&gt;: :emplace_back</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lvalues-and-rvalues"><span class="toc-number">4.2.</span> <span class="toc-text">lvalues and rvalues</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#move-operations-c-11"><span class="toc-number">4.3.</span> <span class="toc-text">move operations(c++11)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-14-Inheritance"><span class="toc-number">5.</span> <span class="toc-text">Lecture 14: Inheritance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Namespaces"><span class="toc-number">5.1.</span> <span class="toc-text">Namespaces</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Inheritance"><span class="toc-number">5.2.</span> <span class="toc-text">Inheritance</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-15-Inheritance-and-Template"><span class="toc-number">6.</span> <span class="toc-text">Lecture 15: Inheritance and Template</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Classes"><span class="toc-number">6.1.</span> <span class="toc-text">Classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Templates-vs-Derived-Classes"><span class="toc-number">6.2.</span> <span class="toc-text">Templates vs Derived Classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Template-Classes"><span class="toc-number">6.3.</span> <span class="toc-text">Template Classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Concepts-and-Constraints-C-20-%E5%A4%8D%E4%B9%A0"><span class="toc-number">6.4.</span> <span class="toc-text">Concepts and Constraints(C++20)å¤ä¹ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-16-RAII-and-Smart-Pointers"><span class="toc-number">7.</span> <span class="toc-text">Lecture 16: RAII and Smart Pointers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%BC%95"><span class="toc-number">7.1.</span> <span class="toc-text">å¯¼å¼•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAII"><span class="toc-number">7.2.</span> <span class="toc-text">RAII</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Smart-Pointers"><span class="toc-number">7.3.</span> <span class="toc-text">Smart Pointers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-17-Multithreading"><span class="toc-number">8.</span> <span class="toc-text">Lecture 17: Multithreading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Further-C-reading"><span class="toc-number">9.</span> <span class="toc-text">Further C++ reading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">10.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">crownZ</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-07-31T04:00:00.000Z" itemprop="datePublished">2022-07-31</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/C/">C++</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">å­¦ä¹ </a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>ç¬”è®°å†…å®¹æ¥è‡ªäºStanford CS106Lçš„2019å¹´ç§‹å­£è§†é¢‘ï¼Œ[é“¾æ¥](<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Ct3QF2qENGM&list=PLCgD3ws8aVdolCexlz8f3U-RROA0s5jWA">CS 106L Fall 2020 - Guest Lecture: Template Metaprogramming - YouTube</a>)ã€‚</p>
<p>ä¸‹åŠéƒ¨åˆ†ä¸»è¦æ˜¯C++çš„ç±»ç›¸å…³æ¦‚å¿µä»¥åŠC++11ä¹‹åçš„ä¸€äº›æ–°ç‰¹æ€§ï¼Œå­¦ä¹ å¦‚ä½•è¿›è¡Œç°ä»£çš„C++ç¼–ç¨‹ã€‚</p>
<h2 id="Lecture-10-Classes-and-Constant"><a href="#Lecture-10-Classes-and-Constant" class="headerlink" title="Lecture 10: Classes and Constant"></a>Lecture 10: Classes and Constant</h2><h3 id="é¢å‘å¯¹è±¡æ¦‚è§ˆ"><a href="#é¢å‘å¯¹è±¡æ¦‚è§ˆ" class="headerlink" title="é¢å‘å¯¹è±¡æ¦‚è§ˆ"></a>é¢å‘å¯¹è±¡æ¦‚è§ˆ</h3><p>åœ¨CS106Bå·²ç»å­¦è¿‡äº†ç®€å•çš„ç±»ã€å¯¹è±¡å’Œå°è£…ï¼Œåç»­å°†å¯¹æŠ½è±¡ï¼Œç»§æ‰¿å’Œå¤šæ€è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„å­¦ä¹ ã€‚C++æ•´ä½“çš„é¢å‘å¯¹è±¡å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘å¯ä»¥æ ¹æ®è¿™å¼ å›¾åˆæ­¥ç†æ¸…æ•´ä¸ªä½“ç³»çš„å„ä¸ªä¸»è¦æ¨¡å—ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/crownz-sec/Blog_Source@master/Stanford-CS106L/OOP-C++.png" alt="OOP-C++"></p>
<p><strong>ä¸ºä»€ä¹ˆC/C++æ–‡ä»¶åç¼€æœ‰è¿™ä¹ˆå¤šçš„æ‹“å±•ï¼Ÿ</strong></p>
<ul>
<li>å¤´æ–‡ä»¶ï¼š.hã€.hhã€.hpp</li>
<li>æºæ–‡ä»¶ï¼š.ccã€.cppã€.cxxã€.c++ã€.C</li>
</ul>
<p>è¿™å–å†³äºç¼–è¯‘å™¨ï¼<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1545080/c-code-file-extension-what-is-the-difference-between-cc-and-cpp/1545085#1545085">å‚è€ƒ</a></p>
<ul>
<li>ä»å†å²ä¸Šçœ‹ï¼Œä½¿ç”¨ .Cï¼ˆå³å¤§å†™ Cï¼‰</li>
<li>ç°åœ¨Unixå¤šä½¿ç”¨.ccï¼ŒUnixä»¥å¤–å¤šä½¿ç”¨.cpp</li>
<li>.h åœ¨æŠ€æœ¯ä¸Šé€‚ç”¨äºCç¨‹åºï¼Œå› æ­¤å¦‚æœæ··åˆCå’Œ C++ ä»£ç ï¼Œè¯·ä½¿ç”¨.hh ä»£æ›¿</li>
</ul>
<h3 id="const-å˜é‡"><a href="#const-å˜é‡" class="headerlink" title="const-å˜é‡"></a>const-å˜é‡</h3><p><strong>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å…¨å±€å˜é‡ï¼Ÿ</strong></p>
<ul>
<li>â€œå…¨å±€å˜é‡å¯ä»¥è¢«ç¨‹åºçš„ä»»ä½•éƒ¨åˆ†è¯»å–æˆ–ä¿®æ”¹ï¼Œå› æ­¤å¾ˆéš¾è®°ä½æˆ–æ¨ç†æ¯ä¸€ç§å¯èƒ½çš„ç”¨é€”â€</li>
<li>â€œå…¨å±€å˜é‡å¯ä»¥ç”±ç¨‹åºçš„ä»»ä½•éƒ¨åˆ†è·å–æˆ–è®¾ç½®ï¼Œä»»ä½•æœ‰å…³å…¶ä½¿ç”¨çš„è§„åˆ™éƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«ç ´åæˆ–é—å¿˜â€</li>
</ul>
<p><strong>ä½¿ç”¨constçš„å¥½å¤„</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((x==<span class="number">2</span> &amp;&amp; y==<span class="number">3</span>) || (x==<span class="number">1</span>))</span><br><span class="line">	    cout &lt;&lt; <span class="string">&#x27;a&#x27;</span> &lt;&lt; endl ;</span><br><span class="line">    <span class="keyword">if</span> ((y==x<span class="number">-1</span>) &amp;&amp; (x==<span class="number">-1</span> || y=<span class="number">-1</span>))</span><br><span class="line">	    cout &lt;&lt; <span class="string">&#x27;b&#x27;</span> &lt;&lt; endl ;</span><br><span class="line">    <span class="keyword">if</span> ((x==<span class="number">3</span>) &amp;&amp; (y==<span class="number">2</span>*x))</span><br><span class="line">	    cout&lt;<span class="string">&#x27;c&#x27;</span>&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œfå‡½æ•°åªæ˜¯ä¸ºäº†å¯¹xå’Œyè¿›è¡Œä¸€äº›æ¯”è¾ƒï¼Œæˆ‘ä»¬æ˜¾ç„¶ä¸ä¼šåœ¨è¯¥å‡½æ•°ä¸­å¯¹å¾…æ¯”è¾ƒå˜é‡è¿›è¡Œä¿®æ”¹ã€‚ä½†æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¼šç”±äºç–å¿½å¯¼è‡´ä¸€äº›ä»£ç å‡ºç°é”™è¯¯ï¼Œè€Œè‡ªå·±åˆå¾ˆéš¾æ‰¾åˆ°bugã€‚åœ¨ä¸Šé¢ä»£ç çš„ç¬¬4è¡Œæœ€å³è¾¹ï¼Œæˆ‘ä»¬æœ¬æœŸæœ›å†™æˆ<code>y==-1</code>ï¼Œä½†å´å†™æˆäº†<code>y=-1</code>ï¼Œè¿™å°±å¯¼è‡´äº†é¢„æœŸä¹‹å¤–çš„é”™è¯¯ã€‚è€Œå¦‚æœåœ¨å‡½æ•°å‚æ•°å¤„ä½¿ç”¨<code>const</code>ï¼Œç¼–è¯‘å™¨å°±å¯ä»¥ä¸ºæˆ‘ä»¬æ‰¾åˆ°bugï¼Œå› ä¸º<code>const</code>ä½¿å¾—è¯¥å‡½æ•°ä¸èƒ½ä¿®æ”¹å¯¹åº”å‚æ•°ã€‚ä½¿ç”¨<code>const</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> x, <span class="keyword">const</span> <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((x==<span class="number">2</span> &amp;&amp; y==<span class="number">3</span>) || (x==<span class="number">1</span>))</span><br><span class="line">	    cout &lt;&lt; <span class="string">&#x27;a&#x27;</span> &lt;&lt; endl ;</span><br><span class="line">    <span class="keyword">if</span> ((y==x<span class="number">-1</span>) &amp;&amp; (x==<span class="number">-1</span> || y=<span class="number">-1</span>))</span><br><span class="line">	    cout &lt;&lt; <span class="string">&#x27;b&#x27;</span> &lt;&lt; endl ;</span><br><span class="line">    <span class="keyword">if</span> ((x==<span class="number">3</span>) &amp;&amp; (y==<span class="number">2</span>*x))</span><br><span class="line">	    cout&lt;<span class="string">&#x27;c&#x27;</span>&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç æ˜¯ä¸€ä¸ªç›¸å½“åŸºæœ¬çš„ç”¨ä¾‹ï¼Œä½†è¿™çœŸçš„æ˜¯<code>const</code>çš„æ‰€æœ‰å¥½å¤„å—ï¼Ÿå¹¶ä¸æ˜¯ï¼Œä¸‹é¢é€šè¿‡ä¾‹å­å­¦ä¹ ã€‚</p>
<p><strong>å› ä½¿ç”¨constè€Œå‡ºé”™çš„ä¾‹å­</strong></p>
<p>å‡è®¾æˆ‘ä»¬æƒ³å¯¹ä¸€ä¸ªæ˜Ÿçƒçš„äººæ•°è¿›è¡Œç»Ÿè®¡ï¼Œå†™å‡ºä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">int</span> <span class="title">countPeople</span><span class="params">(Planet&amp; p)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Hats are the cornerstone of modern society</span></span><br><span class="line">    <span class="built_in">addLittleHat</span>(p);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// More land; oceans were wasting space</span></span><br><span class="line">	<span class="built_in">marsify</span>(p);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// Optimization: destroy planet</span></span><br><span class="line">	<span class="comment">// This makes population counting 0(1)</span></span><br><span class="line">    <span class="built_in">deathStar</span>(p);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“è°ƒç”¨countPeopleæ—¶ï¼Œå…¶å†…éƒ¨åˆè°ƒç”¨äº†å¦å¤–ä¸‰ä¸ªå‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä¼šå¯¹countPeopleæ‰€æ¥å—çš„å‚æ•°pè¿›è¡Œä¿®æ”¹ï¼Œä½†æˆ‘ä»¬å¹¶ä¸æƒ³ä¿®æ”¹pï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šæƒ³åˆ°ä½¿ç”¨<code>const</code>ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">int</span> <span class="title">countPeople</span><span class="params">(<span class="keyword">const</span> Planet&amp; p)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Hats are the cornerstone of modern society</span></span><br><span class="line">    <span class="built_in">addLittleHat</span>(p);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// More land; oceans were wasting space</span></span><br><span class="line">	<span class="built_in">marsify</span>(p);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// Optimization: destroy planet</span></span><br><span class="line">	<span class="comment">// This makes population counting 0(1)</span></span><br><span class="line">    <span class="built_in">deathStar</span>(p);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addLittleHat</span><span class="params">(Planet&amp; p)</span> </span>&#123; </span><br><span class="line">    p.<span class="built_in">add</span>(ğŸ‘’); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†ä»¥ä¸Šä»£ç ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œå› ä¸º<code>addLittleHat</code>ç­‰å…¶ä»–å‡½æ•°å¹¶æ²¡æœ‰å¯¹ä¼ å…¥å‚æ•°è¿›è¡Œ<code>const</code>çš„é™åˆ¶ã€‚åœ¨ <code>p</code> ä¸Šè°ƒç”¨<code>addLittleHat</code>å°±åƒè®¾ç½®ä¸€ä¸ªé<code>const</code>å˜é‡ç­‰äºä¸€ä¸ª<code>const</code>å˜é‡ï¼Œç¼–è¯‘å™¨ä¸å…è®¸è¿™ä¹ˆåšã€‚å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™å¯èƒ½å°±éœ€è¦ä½¿å¾—<code>addLittleHat</code>å‡½æ•°ä¹Ÿç”¨<code>const</code>ä¿®é¥°å‚æ•°<code>p</code>ï¼Œä½†è¿™ä¹ˆåˆä½¿<code>addLittleHat</code>æ— æ³•åœ¨å‡½æ•°ä½“ä¸­å¯¹<code>p</code>åšå‡ºä¿®æ”¹ã€‚è¿™ä½¿å¾—æˆ‘ä»¬é™·å…¥äº†ä¸¤éš¾çš„å¢ƒåœ°ã€‚è¿™æ—¶å¯èƒ½å°±éœ€è¦ä½¿ç”¨<code>mutable</code>æ¥è§£é™¤è¿™ä¸€é™åˆ¶ï¼Œä½†<code>mutable</code>çš„ä½¿ç”¨ä¹Ÿéœ€è¦å†æƒè¡¡ä¸€ç•ªï¼Œå› ä¸ºéšæ„ä½¿ç”¨<code>mutable</code>çš„è¯ï¼Œç­‰äº<code>const</code>çš„ä½¿ç”¨ä¹Ÿæ²¡æœ‰æ„ä¹‰äº†ã€‚</p>
<p>æ€»ç»“èµ·æ¥ï¼Œ<code>const</code>å…è®¸æˆ‘ä»¬æ¨æ–­å˜é‡æ˜¯å¦ä¼šæ”¹å˜ã€‚ä»£ç æè¿°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// The value of x here</span></span><br><span class="line">    <span class="built_in">aConstMethod</span>(x) ;</span><br><span class="line">    <span class="built_in">anotherConstMethod</span>(x) ;</span><br><span class="line">    <span class="comment">// Is the same value of x here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="const-æŒ‡é’ˆ"><a href="#const-æŒ‡é’ˆ" class="headerlink" title="const-æŒ‡é’ˆ"></a>const-æŒ‡é’ˆ</h3><p>ä½¿ç”¨å¸¦æœ‰<code>const</code>çš„æŒ‡é’ˆæœ‰ç‚¹æ£˜æ‰‹ï¼Œå¦‚æœ‰ç–‘é—®ï¼Œè¯·ä»å³åˆ°å·¦é˜…è¯»ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// constant pointer to a non-constant int</span></span><br><span class="line"><span class="keyword">int</span> * <span class="keyword">const</span> p;	<span class="comment">// (*p)++; OK!</span></span><br><span class="line">				<span class="comment">// p++; NOT allowed!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// non-constant pointer to a constant int</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* p;   <span class="comment">// (*p)++; Not OK!</span></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span>* p;	<span class="comment">// same with above line</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// constant pointer to a constant int</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* <span class="keyword">const</span> p;</span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span>* <span class="keyword">const</span> p;</span><br></pre></td></tr></table></figure>

<h3 id="const-è¿­ä»£å™¨"><a href="#const-è¿­ä»£å™¨" class="headerlink" title="const-è¿­ä»£å™¨"></a>const-è¿­ä»£å™¨</h3><ul>
<li>è¯·è®°ä½ï¼Œè¿­ä»£å™¨çš„ä½œç”¨ç±»ä¼¼äºæŒ‡é’ˆ</li>
<li><code>const vector&lt;int&gt;::iterator itr</code>çš„è¡Œä¸ºç±»ä¼¼äº<code>int* const itr</code></li>
<li>è¦ä½¿è¿­ä»£å™¨åªè¯»ï¼Œè¯·å®šä¹‰ä¸€ä¸ªæ–°çš„<code>const</code>è¿­ä»£å™¨</li>
</ul>
<p>ä¾‹å­1ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vector v&#123;<span class="number">1</span>, <span class="number">2312</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> vector&lt;<span class="keyword">int</span>&gt;::iterator itr = v.<span class="built_in">begin</span>();</span><br><span class="line">++itr;		<span class="comment">// doesn&#x27;t compile</span></span><br><span class="line">*itr = <span class="number">15</span>; 	<span class="comment">// compiles </span></span><br></pre></td></tr></table></figure>

<p>ä¾‹å­2:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vector&lt;<span class="keyword">int</span>&gt;::iterator itr = v.<span class="built_in">begin</span>();</span><br><span class="line">*itr = <span class="number">5</span>; 	<span class="comment">//0K! changing what itr points to</span></span><br><span class="line">++itr; 		<span class="comment">//BAD! can&#x27;t modify itr</span></span><br><span class="line"></span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt;::const_iterator itr = v.<span class="built_in">begin</span>();</span><br><span class="line">*itr = <span class="number">5</span>; 	<span class="comment">//BAD! can&#x27;t change value of itr</span></span><br><span class="line">++itr; 		<span class="comment">//0K! changing v</span></span><br><span class="line"><span class="keyword">int</span> value = *itr; <span class="comment">//0K! reading from itr</span></span><br></pre></td></tr></table></figure>

<h3 id="constå›é¡¾"><a href="#constå›é¡¾" class="headerlink" title="constå›é¡¾"></a>constå›é¡¾</h3><p>ä¸€äº›å°çš„æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»»ä½•æ²¡æœ‰è¢«ä¿®æ”¹çš„ä¸œè¥¿éƒ½åº”è¯¥è¢«æ ‡è®°ä¸º<code>const</code></li>
<li>é€šè¿‡<code>const</code>å¼•ç”¨ä¼ é€’ä¼˜äºä¼ é€’å€¼<ul>
<li>å¯¹åŸè¯­ï¼ˆboolã€intç­‰ï¼‰æ¥è¯´ï¼Œå¹¶ä¸æ­£ç¡®ï¼ˆå› ä¸ºæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œä¼ å€¼ä¸ä¼ å¼•ç”¨å¹¶æ²¡æœ‰å¾ˆå¤§çš„å¼€é”€åŒºåˆ«ï¼‰</li>
</ul>
</li>
<li>æˆå‘˜å‡½æ•°åº”è¯¥åŒæ—¶å…·æœ‰<code>const</code>å’Œé<code>const</code>è¿­ä»£å™¨</li>
<li>ä»å³åˆ°å·¦é˜…è¯»ï¼Œä»¥äº†è§£æŒ‡é’ˆ</li>
<li>è¯·ä¸è¦åˆ¶é€ ç‚¸æ¯åœ°çƒçš„æ–¹æ³•</li>
</ul>
<p><code>const</code>å¯¹è±¡ï¼š</p>
<p>é€šè¿‡åªå…è®¸è°ƒç”¨<code>const</code>å‡½æ•°å¹¶å°†æ‰€æœ‰å…¬å…±æˆå‘˜è§†ä¸º<code>const</code>æ¥ä¿è¯å¯¹è±¡ä¸ä¼šæ”¹å˜ã€‚è¿™æœ‰åŠ©äºç¨‹åºå‘˜ç¼–å†™å®‰å…¨çš„ä»£ç ï¼Œå¹¶ä¸ºç¼–è¯‘å™¨æä¾›æ›´å¤šä¿¡æ¯ä»¥ç”¨äºä¼˜åŒ–ã€‚</p>
<p><code>const</code>å‡½æ•°ï¼š</p>
<p>ä¿è¯è¯¥å‡½æ•°ä¸ä¼šè°ƒç”¨é™¤<code>const</code>å‡½æ•°ä¹‹å¤–çš„ä»»ä½•ä¸œè¥¿ï¼Œå¹¶ä¸”ä¸ä¼šä¿®æ”¹ä»»ä½•éé™æ€ï¼ˆnon-staticï¼‰ã€éå¯å˜ï¼ˆnon-mutableï¼‰æˆå‘˜ã€‚</p>
<p>æ ¹æ®æ‰€å­¦çŸ¥è¯†ï¼Œè§£é‡Šä»¥ä¸‹ä»£ç ä¸­æ¯ä¸ª<code>const</code>çš„å«ä¹‰ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">int</span>* <span class="keyword">const</span> <span class="title">maClassMethod</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>* <span class="keyword">const</span> &amp; param)</span> <span class="keyword">const</span></span>;</span><br></pre></td></tr></table></figure>

<p>ç¬¬1ä¸ªï¼šå‡½æ•°è¿”å›çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ª<code>const int</code>å€¼</p>
<p>ç¬¬2ä¸ªï¼šå‡½æ•°è¿”å›ä¸€ä¸ª<code>const</code>æŒ‡é’ˆ</p>
<p>ç¬¬3ä¸ªï¼šparamæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ª<code>const int</code>å€¼</p>
<p>ç¬¬4ä¸ªï¼šè¯¥å‡½æ•°æ¥å—ä¸€ä¸ª<code>const</code>æŒ‡é’ˆparam </p>
<p>ç¬¬5ä¸ªï¼šè¿™æ˜¯ä¸€ä¸ª<code>const</code>æˆå‘˜å‡½æ•°ï¼Œå³è¿™ä¸ªå‡½æ•°ä¸èƒ½ä¿®æ”¹è¿™ä¸ªï¼ˆthisï¼‰å®ä¾‹çš„ä»»ä½•å˜é‡</p>
<p>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨è¿™äº›ä¸åŒç”¨æ³•ï¼Ÿå‚è€ƒé“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/15999123/const-before-parameter-vs-const-after-function-name-c">const before parameter vs const after function name c++ - Stack Overflow</a></p>
<h2 id="Lecture-11-Operators"><a href="#Lecture-11-Operators" class="headerlink" title="Lecture 11: Operators"></a>Lecture 11: Operators</h2><p>ä¸»è¦é€šè¿‡ä¸€ç³»åˆ—ä»£ç å»è®²è¿ç®—ç¬¦é‡è½½ã€‚</p>
<h3 id="é‡è½½çš„ä¸€èˆ¬ç»éªŒæ³•åˆ™"><a href="#é‡è½½çš„ä¸€èˆ¬ç»éªŒæ³•åˆ™" class="headerlink" title="é‡è½½çš„ä¸€èˆ¬ç»éªŒæ³•åˆ™"></a>é‡è½½çš„ä¸€èˆ¬ç»éªŒæ³•åˆ™</h3><ol>
<li>ç”±äºC++çš„è¯­ä¹‰ï¼ŒæŸäº›è¿ç®—ç¬¦å¿…é¡»å®ç°ä¸ºå¯¹åº”ç±»çš„æˆå‘˜å‡½æ•°ï¼ˆä¾‹å¦‚[]ã€()ã€-&gt;ã€=ï¼‰ã€‚</li>
<li>æœ‰çš„å¿…é¡»ä»¥éæˆå‘˜å‡½æ•°çš„æ–¹å¼æ‰§è¡Œï¼ˆä¾‹å¦‚ï¼Œ&lt;&lt;ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä¸ºrhsè€Œä¸æ˜¯Ihsç¼–å†™ç±»ï¼‰ã€‚ï¼ˆè‡ªå·±ç†è§£ï¼šlhså·¦å‚æ•°ï¼Œrhså³å‚æ•°ï¼‰</li>
<li>å¦‚æœæ˜¯ä¸€å…ƒè¿ç®—ç¬¦ï¼ˆä¾‹å¦‚ ++ï¼‰ï¼Œåˆ™å°†å…¶ä½œä¸ºæˆå‘˜å‡½æ•°å®ç°ã€‚</li>
<li>å¦‚æœæ˜¯äºŒå…ƒçš„ä¸”åŒç­‰å¯¹å¾…ä¸¤ä¸ªæ“ä½œæ•°çš„è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚ï¼Œä¸¤ä¸ªéƒ½æœªæ›´æ”¹ï¼‰ï¼Œå°†å…¶å®ç°ä¸ºéæˆå‘˜å‡½æ•°ï¼ˆå¯èƒ½æ˜¯å‹å…ƒå‡½æ•°ï¼‰ã€‚ç¤ºä¾‹ï¼š+ã€&lt;ã€‚</li>
<li>å¦‚æœæ˜¯äºŒå…ƒçš„ä¸”ä¸æ˜¯åŒç­‰å¯¹å¾…ä¸¤è€…çš„è¿ç®—ç¬¦ï¼ˆæ›´æ”¹äº†Ihsï¼‰ï¼Œåˆ™å®ç°ä¸ºæˆå‘˜å‡½æ•°ï¼ˆå…è®¸è½»æ¾è®¿é—® Ihs çš„ç§æœ‰æˆå‘˜ï¼‰ã€‚ç¤ºä¾‹ï¼š+=ã€‚</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆè¦é€šè¿‡éæˆå‘˜çš„æ–¹å¼é‡è½½&lt;&lt;ï¼Ÿ</strong></p>
<p>å‡è®¾æˆ‘ä»¬å¯ä»¥é€šè¿‡æˆå‘˜çš„æ–¹å¼å»é‡è½½ï¼Œè¿™æ ·ç›¸å½“äºæˆ‘ä»¬å¯¹<code>ostream</code>æ·»åŠ äº†ä¸€ä¸ªæˆå‘˜å‡½æ•°ã€‚ä½†<code>ostream</code>æ˜¯STLåº“çš„å†…å®¹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå…¶åªå¯ä½¿ç”¨ï¼Œè€Œæ— æ³•æ›´æ”¹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡æˆå‘˜çš„æ–¹å¼å»é‡è½½&lt;&lt;ï¼Œè½¬è€Œé€šè¿‡éæˆå‘˜çš„æ–¹å¼é‡è½½ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="keyword">const</span> Fraction&amp; f) &#123;</span><br><span class="line">    os &lt;&lt; f.num &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; f.denam;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸ºä»€ä¹ˆè¿”å›å€¼æ˜¯ostreamçš„å¼•ç”¨ï¼Ÿ</span></span><br><span class="line"><span class="comment">// å› ä¸ºè¿™å¯ä»¥ä½¿å¾—è¿ç»­coutä¹Ÿèƒ½æˆåŠŸï¼Œå³cout &lt;&lt; fraction1 &lt;&lt; fraction2</span></span><br><span class="line"><span class="comment">// å¯¹äºè¿ç»­çš„coutï¼Œç¼–è¯‘å™¨ä¼šå°†å…¶è½¬æ¢ä¸ºï¼šcout.operator&lt;&lt;(fraction1).operator&lt;&lt;(fraction2)</span></span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹åˆ°ï¼Œä»¥ä¸Šç¼–è¯‘å™¨çš„ä»£ç ä½¿ç”¨äº†fraction1è¿”å›çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸Šé¢è¦è¿”å›ostreamçš„å¼•ç”¨</span></span><br></pre></td></tr></table></figure>

<p>ä½†ä¸æ˜¯Fractionæˆå‘˜å‡½æ•°çš„&lt;&lt;å¦‚ä½•è®¿é—®å…¶ç§æœ‰å˜é‡å‘¢ï¼Ÿä½¿ç”¨<code>friend</code>å…³é”®å­—ï¼Œå°†å¯¹åº”å‡½æ•°å£°æ˜ä¸ºå‹å…ƒå‡½æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fraction</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Fraction</span>();</span><br><span class="line">	<span class="built_in">Fraction</span>(<span class="keyword">int</span> num, <span class="keyword">int</span> denom);</span><br><span class="line">	<span class="comment">// operator double const;</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">const</span> Fraction&amp; f)</span></span>; </span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">mult</span><span class="params">(<span class="keyword">const</span> Fraction&amp; f)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">decimal</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getDenom</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> num;	<span class="comment">// the numerator</span></span><br><span class="line">	<span class="keyword">int</span> denom; <span class="comment">// the denominator</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">reduce</span><span class="params">()</span></span>; <span class="comment">// reduce the fraction to lowest terms</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">friend</span> operators&lt;&lt;(ostream&amp; os, <span class="keyword">const</span> Fraction&amp; f);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸€äº›å…³é”®è¦ç‚¹</strong></p>
<ol>
<li>å§‹ç»ˆè€ƒè™‘æ˜¯å¦è¦ä½¿ç”¨constä¿®é¥°å‚æ•°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ­£åœ¨ä¿®æ”¹æµï¼Œè€Œä¸æ˜¯Fractionç»“æ„ï¼Œæ‰€ä»¥ï¼Œè¦ç”¨constä¿®é¥°Fractionã€‚</li>
<li>è¿”å›å¼•ç”¨ï¼Œä»¥æ”¯æŒé“¾å¼ &lt;&lt; çš„è°ƒç”¨ã€‚</li>
<li>è¿™é‡Œæˆ‘ä»¬é‡è½½äº†&lt;&lt;ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç±»ä½œä¸ºrhså·¥ä½œï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½æ”¹å˜Ihsï¼ˆstream libraryï¼‰çš„ç±»ã€‚</li>
<li>å½“ä½ éœ€è¦å®ç°ä¸€ä¸ªéæˆå‘˜å‡½æ•°ï¼Œå´åˆéœ€è¦è®¿é—®ç§æœ‰å˜é‡æ—¶ï¼Œä½¿ç”¨<code>friend</code>ã€‚</li>
</ol>
<h3 id="Principle-of-Least-Astonishment-POLA"><a href="#Principle-of-Least-Astonishment-POLA" class="headerlink" title="Principle of Least Astonishment(POLA)"></a>Principle of Least Astonishment(POLA)</h3><p>ä»¥ä¸Šæ ‡é¢˜çš„å­—é¢ç¿»è¯‘ï¼šæœ€å°æƒŠå¥‡åŸåˆ™ã€‚åŸºæœ¬æ„æ€ï¼Œå½“ä½ æ­£åœ¨ä½¿ç”¨å®ç°ä»–äººéœ€è¦ä½¿ç”¨çš„ä»£ç æ—¶ï¼Œä½ æœ€å¥½é€šè¿‡åˆ«äººä¸ä¼šæ„Ÿåˆ°æƒŠè®¶çš„æ–¹å¼å»å®ç°å®ƒã€‚</p>
<blockquote>
<p>â€œIf a necessary feature has a high astonishment factor, it may be necessary to redesign the featureâ€.</p>
</blockquote>
<ul>
<li><p>è®¾è®¡è¿ç®—ç¬¦ä¸»è¦æ˜¯ä¸ºäº†æ¨¡ä»¿ä¼ ç»Ÿç”¨æ³•ï¼ˆDesign operators primarily to mimic conventional usageï¼‰</p>
</li>
<li><p>å¯¹å¯¹ç§°è¿ç®—ç¬¦ï¼ˆ+ï¼Œ-ç­‰ï¼‰ä½¿ç”¨éæˆå‘˜å‡½æ•°å®ç°ï¼ˆUse nonmember functions for symmetric operatorsï¼‰</p>
<p>ä»¥ä»£ç ä¸¾ä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Fraction a &#123;<span class="number">3</span>, <span class="number">8</span>&#125;;</span><br><span class="line">Fraction b &#123;<span class="number">11</span>, <span class="number">8</span>&#125;;</span><br><span class="line"><span class="comment">// equivalent to a.operator+(0.5), compiles</span></span><br><span class="line"><span class="keyword">if</span> (a + <span class="number">1</span> == b) cout &lt;&lt; <span class="string">&quot;I &lt;3 fractions!&quot;</span>;</span><br><span class="line"><span class="comment">// equivalent to 0.5.operator+(a), does not compile </span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">1</span> + a == b) cout &lt;&lt; <span class="string">&quot;I &lt;3 fractions!&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä»¥æˆå‘˜å‡½æ•°å®ç°+ï¼Œé‚£ä¹ˆåªæœ‰ä¸€è¡Œåˆ¤æ–­ä»£ç å¯è¡Œï¼Œè€Œç¬¬äºŒè¡Œä¸å¯è¡Œï¼Œå› ä¸ºæˆ‘ä»¬åªç»™Fractionè¿™ä¸€ç±»å®ç°äº†å¯¹åº”çš„è¿ç®—ç¬¦ã€‚ä½†ç¬¬äºŒè¡Œåˆ¤æ–­ä»£ç æ˜¯å¾ˆå¸¸è§çš„ä½¿ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦æ”¯æŒè¿™æ ·çš„ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡éæˆå‘˜å‡½æ•°å®ç°+ã€‚</p>
</li>
<li><p>å§‹ç»ˆæä¾›ä¸€ç»„ç›¸å…³è¿ç®—ç¬¦ä¸­çš„æ‰€æœ‰è¿ç®—ç¬¦ï¼ˆAlways provide all out of a set of related operatorsï¼‰</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ å®ç°äº†==è¿ç®—ç¬¦ï¼Œé‚£ä½ éœ€è¦æŠŠ!=ï¼Œ&lt;ç­‰ä¸€ç³»åˆ—é€»è¾‘æ¯”è¾ƒè¿ç®—ç¬¦ä¹Ÿå®ç°äº†ã€‚å› ä¸ºå¦‚æœæ²¡æœ‰å®ç°ï¼Œå½“ç”¨æˆ·ä½¿ç”¨å…¶ä»–è¿ç®—ç¬¦ï¼Œå´å‘ç°æ²¡æœ‰æ—¶ï¼Œä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚</p>
</li>
</ul>
<h2 id="Lecture-12-Special-Member-Functions"><a href="#Lecture-12-Special-Member-Functions" class="headerlink" title="Lecture 12: Special Member Functions"></a>Lecture 12: Special Member Functions</h2><p>ç‰¹æ®Šæˆå‘˜å‡½æ•°çš„åˆæ­¥ç†è§£ï¼šå¦‚æœä½ æ²¡æœ‰åœ¨ä½ çš„ç±»ä¸­è¿›è¡Œå£°æ˜ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°†ä¼šä¸ºä½ åˆ›å»ºå¯¹åº”çš„æˆå‘˜å‡½æ•°ã€‚</p>
<h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><p>ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨çš„å¥½å¤„ï¼šå½“ä¼ å…¥å‚æ•°å’Œæˆå‘˜å˜é‡åŒåæ—¶ï¼Œå¯ä»¥é¿å…ä½¿ç”¨thisæŒ‡é’ˆã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å› ä¸ºä¼ å…¥å‚æ•°å’Œæˆå‘˜å˜é‡åŒåï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨thisæŒ‡é’ˆè¿›è¡ŒåŒºåˆ†</span></span><br><span class="line">Fraction::<span class="built_in">Fraction</span>(<span class="keyword">int</span> num, <span class="keyword">int</span> denom) &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;num = num;</span><br><span class="line">    <span class="keyword">this</span>-&gt;denom = denom;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">reduce</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯ä»¥ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨å»é¿å…ä»¥ä¸Šæƒ…å†µ</span></span><br><span class="line">Fraction::<span class="built_in">Fraction</span>():<span class="built_in">num</span>(num), <span class="built_in">denom</span>(denom) &#123;</span><br><span class="line">    <span class="built_in">reduce</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="copy-operations"><a href="#copy-operations" class="headerlink" title="copy operations"></a>copy operations</h3><p>ç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼ˆé€šå¸¸ï¼‰ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆï¼Œå…¶ç±»åˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>é»˜è®¤æ„é€ ï¼ˆDefault constructorï¼‰ï¼šåˆ›å»ºæ²¡æœ‰å‚æ•°çš„å¯¹è±¡ã€‚</li>
<li>æ‹·è´æ„é€ å‡½æ•°ï¼ˆCopy constructorï¼‰ï¼šå¯¹è±¡è¢«åˆ›å»ºä¸ºç°æœ‰å¯¹è±¡çš„å‰¯æœ¬ã€‚</li>
<li>æ‹·è´èµ‹å€¼ï¼ˆCopy assignmentï¼‰ï¼šç°æœ‰å¯¹è±¡è¢«æ›¿æ¢ä¸ºå¦ä¸€ä¸ªç°æœ‰å¯¹è±¡çš„å‰¯æœ¬ã€‚</li>
<li>ææ„å‡½æ•°ï¼ˆDestructorï¼‰ï¼šå¯¹è±¡åœ¨è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶è¢«é”€æ¯ã€‚</li>
</ul>
<p> åœ¨ä»¥ä¸‹ä»£ç ä¸­ï¼Œåˆ¤æ–­æ¯ä¸€è¡Œæ‰€å¯¹åº”çš„<code>StringVector</code>å¯¹è±¡æ‰€è°ƒç”¨çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Stringvector <span class="title">function</span><span class="params">(Stringvector vec0)</span> </span>&#123; <span class="comment">// æ‹·è´æ„é€ å‡½æ•°ã€‚å› ä¸ºå‚æ•°æ˜¯ä¼ å€¼çš„ï¼Œæ‰€ä»¥ä¼šåˆ›å»ºä¸€ä¸ªåŸå¯¹è±¡çš„æ‹·è´</span></span><br><span class="line">    StringVector vec1;			<span class="comment">// é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    StringVector vec2&#123;<span class="string">&quot;Ito&quot;</span>, <span class="string">&quot;En&quot;</span>, <span class="string">&quot;Green&quot;</span>&#125;;<span class="comment">// ç”¨æˆ·æ‰€å®šä¹‰çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸ä¼šè°ƒç”¨ç‰¹æ®Šæˆå‘˜å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œä¼šç¼–è¯‘é”™è¯¯</span></span><br><span class="line">    <span class="function">StringVector <span class="title">vec3</span><span class="params">()</span></span>;		<span class="comment">// å£°æ˜äº†ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function">StringVector <span class="title">vec4</span><span class="params">(vec2)</span></span>;	<span class="comment">// æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    StringVector vec5&#123;&#125;;		<span class="comment">// é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    StringVector vec6&#123;vec3 + vec4&#125;;<span class="comment">// æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">    StringVector vec7 = vec4;	<span class="comment">// æ‹·è´æ„é€ å‡½æ•°ï¼Œå› ä¸ºvec7åœ¨ä¹‹å‰å¹¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</span></span><br><span class="line">    vec7 = vec2:				<span class="comment">// æ‹·è´èµ‹å€¼ï¼Œå› ä¸ºå­˜åœ¨çš„å¯¹è±¡vec7åœ¨è¢«vec2çš„å¤åˆ¶æ‰€è¦†ç›–</span></span><br><span class="line">    <span class="keyword">return</span> vec7:				<span class="comment">// æ‹·è´æ„é€ å‡½æ•°ï¼Œå› ä¸ºä»å‡½æ•°ä¸­è¿”å›æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„vecå¯¹è±¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ‹·è´æ“ä½œå¿…é¡»æ‰§è¡Œçš„ä»»åŠ¡</strong></p>
<p>æ‹·è´æ„é€ å‡½æ•°ï¼š</p>
<ul>
<li><p>ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ‹·è´èµ‹å€¼æ­£ç¡®çš„æˆå‘˜ï¼ˆintã€å…¶ä»–å¯¹è±¡ç­‰ï¼‰</p>
<p>Use initializer list to copy members where assignment does the correct thing.ï»¿ï»¿(int, other objects, etc.)</p>
</li>
<li><p>å½“èµ‹å€¼ä¸èµ·ä½œç”¨æ—¶ï¼Œæ·±æ‹·è´æ‰€æœ‰çš„æˆå‘˜ï¼ˆæŒ‡å‘å †å†…å­˜çš„æŒ‡é’ˆï¼‰</p>
<p>Deep copy all members where assignment does not work.ï»¿()ï»¿pointers to heap memory)</p>
</li>
</ul>
<p>æ‹·è´èµ‹å€¼ï¼š</p>
<ul>
<li><p>æ¸…ç†ç°æœ‰å¯¹è±¡ä¸­å³å°†è¢«è¦†ç›–çš„æ‰€æœ‰èµ„æº</p>
<p>Clean up any resources in the existing object about to be overwritten.</p>
</li>
<li><p>å½“èµ‹å€¼èµ·ä½œç”¨æ—¶ï¼Œä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ‹·è´æˆå‘˜</p>
<p>Copy members using initializer list when assignment works.</p>
</li>
<li><p>å½“èµ‹å€¼ä¸èµ·ä½œç”¨ï¼Œæ·±æ‹·è´æˆå‘˜</p>
<p>Deep copy members where assignment does not work.</p>
</li>
</ul>
<p><strong>ä¸€ä¸ªé—®é¢˜</strong></p>
<p>é»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°ä¼šå°†æŒ‡é’ˆä¹Ÿèµ‹å€¼åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™æ„å‘³ç€ä¸¤ä¸ªå¯¹è±¡åœ¨æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªå†…å®¹ä¹Ÿéšä¹‹ä¿®æ”¹ï¼Œå¹¶æ²¡åˆ›å»ºæˆ‘ä»¬æ‰€æƒ³è¦çš„å†…å®¹ç›¸åŒï¼Œä½†åœ°å€ä¸åŒçš„å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è‡ªå·±çš„æ‹·è´æ„é€ å‡½æ•°ã€‚</p>
<p><strong>æ‹·è´æ„é€ å‡½æ•°</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StringVector::<span class="built_in">StringVector</span>(<span class="keyword">const</span> StringVector&amp; other) <span class="keyword">noexcept</span> :  </span><br><span class="line">  <span class="built_in">logicalSize</span>(other.logivalSize), <span class="built_in">allocatedSize</span>(other.allocatedSize) &#123;</span><br><span class="line">	elems = <span class="keyword">new</span> std::string[allocatedSize];</span><br><span class="line">	std::<span class="built_in">copy</span>(other.<span class="built_in">begin</span>(), other.<span class="built_in">end</span>(), <span class="built_in">begin</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// noexceptå…³é”®å­—çš„ä½œç”¨ï¼š</span></span><br><span class="line"><span class="comment">// è¯¥å…³é”®å­—å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå‡½æ•°ä¸­ä¸ä¼šå‘ç”Ÿå¼‚å¸¸,è¿™æœ‰åˆ©äºç¼–è¯‘å™¨å¯¹ç¨‹åºåšæ›´å¤šçš„ä¼˜åŒ–ã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœåœ¨è¿è¡Œæ—¶ï¼Œnoexecptå‡½æ•°å‘å¤–æŠ›å‡ºäº†å¼‚å¸¸ï¼ˆå¦‚æœå‡½æ•°å†…éƒ¨æ•æ‰äº†å¼‚å¸¸å¹¶å®Œæˆå¤„ç†ï¼Œè¿™ç§æƒ…å†µä¸ç®—æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œç¨‹åºä¼šç›´æ¥ç»ˆæ­¢ï¼Œè°ƒç”¨std::terminate()å‡½æ•°ï¼Œè¯¥å‡½æ•°å†…éƒ¨ä¼šè°ƒç”¨std::abort()ç»ˆæ­¢ç¨‹åºã€‚</span></span><br><span class="line"><span class="comment">// Referenceï¼šhttps://www.cnblogs.com/sword03/p/10020344.html</span></span><br></pre></td></tr></table></figure>

<p><strong>æ‹·è´èµ‹å€¼</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åº”è¯¥æ”¯æŒä¸€ä¸‹æ“ä½œï¼š</span></span><br><span class="line"><span class="comment">// StringVector v1, v2;</span></span><br><span class="line"><span class="comment">// v1 = v2;</span></span><br><span class="line"><span class="comment">// v1.operator=(v2);</span></span><br><span class="line"><span class="comment">// v1 = (v2 = v3)</span></span><br><span class="line"><span class="comment">// v1 = v1ï¼ˆè¾¹ç•Œæ¡ä»¶ï¼‰</span></span><br><span class="line">StringVector&amp; StringVector::<span class="keyword">operator</span>=(<span class="keyword">const</span> StringVector&amp; other) &#123;</span><br><span class="line">	<span class="comment">// copy logicalSize, copy allocatedSize, make sure array length are same</span></span><br><span class="line">    <span class="comment">// free the old vectorï¼ˆå› ä¸ºæ‹·è´èµ‹å€¼æ˜¯å¯¹å·²æœ‰å¯¹è±¡çš„å„ç§å‚æ•°è¿›è¡Œé‡æ–°èµ‹å€¼ï¼Œæ‰€ä»¥éœ€è¦åˆ é™¤æ—§æœ‰çš„æ•°æ®ç©ºé—´ï¼‰</span></span><br><span class="line">	<span class="comment">// change elems to a new array of size allocatedSize</span></span><br><span class="line">    <span class="comment">// copy elems from other to this</span></span><br><span class="line">    <span class="comment">// æ¯”è¾ƒåœ°å€ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„å…·ä½“å€¼ï¼ˆ*this != otherï¼‰ï¼Œå› ä¸ºå¦‚æœæ˜¯å…·ä½“å€¼ï¼Œå°±ç›¸å½“äºè°ƒç”¨å¯¹è±¡çš„==æ“ä½œç¬¦ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä½†æˆ‘ä»¬å¹¶æ²¡æœ‰å®ç°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> != &amp;other) &#123;	<span class="comment">// å¯¹`v1 = v1`è¿™ç§æƒ…å†µçš„åˆ¤æ–­ï¼Œå‡ºç°è¿™ç§æƒ…å†µé¿å…èµ‹å€¼ï¼Œç›´æ¥è¿”å›è‡ªèº«</span></span><br><span class="line">        <span class="keyword">delete</span> [] elems;</span><br><span class="line">        allocatedSize = other.allocatedSize;</span><br><span class="line">        logicalSize = other.logicalSize;</span><br><span class="line">        elems = <span class="keyword">new</span> std::string[allocatedSize];</span><br><span class="line">        std::<span class="built_in">copy</span>(other.<span class="built_in">begin</span>(), other.<span class="built_in">end</span>(), <span class="built_in">begin</span>());</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>é˜»æ­¢æ‹·è´çš„æ–¹æ³•</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoggedVector</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">LoggedVector</span>(<span class="keyword">int</span> num, <span class="keyword">int</span> denom) ;</span><br><span class="line">    ~<span class="built_in">LoggedVector</span>();</span><br><span class="line">    <span class="comment">// other methods</span></span><br><span class="line">    <span class="comment">// é€šè¿‡æ˜¾å¼çš„å£°æ˜ï¼Œæ¥é˜»æ­¢æ‹·è´å‡½æ•°çš„è°ƒç”¨ã€‚å¦‚æœè°ƒç”¨äº†ï¼Œä¼šå‘ç”Ÿç¼–è¯‘å™¨é”™è¯¯ã€‚</span></span><br><span class="line">    <span class="built_in">LoggedVector</span> (<span class="keyword">const</span> LoggedVector&amp; rhs) = <span class="keyword">delete</span>;</span><br><span class="line">    LoggedVector&amp; <span class="keyword">operator</span>= (<span class="keyword">const</span> Loggedvector: hs) = <span class="keyword">delete</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">// other stuff</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€‚ç”¨çš„æƒ…å†µï¼šå¯¹äº<code>ifstream</code>è¿™ç§å¯¹è±¡ï¼Œæˆ‘ä»¬ä»ä¸­è¯»å…¥ä¸è¯»å‡ºä¿¡æ¯ï¼Œå¹¶ä¸æƒ³å¯¹å…¶æœ¬èº«è¿›è¡Œæ‹·è´ã€‚æ„æ€æ˜¯å¯¹äºè¿™ç±»å¯¹è±¡ï¼Œåªæœ‰å®ƒä»¬çš„å†…å®¹æ‰æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå¯¹å®ƒä»¬æœ¬èº«åšæ‹·è´å¹¶ä¸èƒ½å¸¦æ¥æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p>
<p><strong>ä½•æ—¶å†™è‡ªå·±ç‰¹æ®Šæˆå‘˜å‡½æ•°</strong></p>
<ul>
<li>å½“ç¼–è¯‘å™¨ç”Ÿæˆçš„é»˜è®¤å‡½æ•°ä¸èµ·ä½œç”¨æ—¶<br>æœ€å¸¸è§çš„åŸå› ï¼šæ‰€æœ‰æƒé—®é¢˜<br>æˆå‘˜æ˜¯ç±»å¤–éƒ¨èµ„æºçš„å¥æŸ„ã€‚ï¼ˆä¾‹å¦‚ï¼šæŒ‡é’ˆã€äº’æ–¥é‡ã€æ–‡ä»¶æµã€‚ï¼‰</li>
<li>å¦‚æœæ˜¾å¼åœ°å®šä¹‰ï¼ˆæˆ–åˆ é™¤ï¼‰æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼æˆ–ææ„å‡½æ•°ï¼Œåˆ™åº”å®šä¹‰ï¼ˆæˆ–åˆ é™¤ï¼‰æ‰€æœ‰è¿™ä¸‰ä¸ªã€‚<br>ç†ç”±æ˜¯ä»€ä¹ˆï¼Ÿ å› ä¸ºå®šä¹‰å…¶ä¸­ä¹‹ä¸€çš„äº‹å®æ„å‘³ç€ä½ çš„æˆå‘˜ä¹‹ä¸€å­˜åœ¨éœ€è¦è§£å†³çš„æ‰€æœ‰æƒé—®é¢˜ã€‚è€Œæ‰€æœ‰æƒé—®é¢˜æ­£æ˜¯æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç‰¹æ®Šæˆå‘˜å‡½æ•°çš„åŸå› ä¹‹ä¸€ã€‚</li>
</ul>
<p><strong>æ³¨æ„ï¼šå¦‚æœé»˜è®¤æ“ä½œæœ‰æ•ˆï¼Œåˆ™ä¸è¦å®šä¹‰ä½ è‡ªå·±çš„è‡ªå®šä¹‰æ“ä½œã€‚</strong></p>
<h3 id="copy-elisionå’ŒRVOï¼ˆreturn-value-optimizationï¼‰"><a href="#copy-elisionå’ŒRVOï¼ˆreturn-value-optimizationï¼‰" class="headerlink" title="copy elisionå’ŒRVOï¼ˆreturn value optimizationï¼‰"></a>copy elisionå’ŒRVOï¼ˆreturn value optimizationï¼‰</h3><p>æ‹·è´çœç•¥ï¼ˆcopy elisionï¼‰å’Œè¿”å›å€¼ä¼˜åŒ–ï¼ˆRVOï¼‰ï¼Œæ˜¯C++11åŠä¹‹åè¯­è¨€æ ‡å‡†ä¸­å®šä¹‰çš„ç¼–è¯‘ä¼˜åŒ–æŠ€æœ¯ã€‚ä¸­å¿ƒæ€æƒ³ï¼š<strong>ä¸€ä¸ªå‡½æ•°è‹¥ç›´æ¥è¿”å›ç±»å¯¹è±¡ï¼Œä¸€èˆ¬ä¼šç”Ÿæˆä¸´æ—¶ç±»å¯¹è±¡å˜é‡ï¼Œè¿™éœ€è¦å¤šæ¬¡è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼ˆcopy constructorï¼‰ï¼Œé€ æˆæ•ˆç‡ä½ä¸‹ã€‚è¿™é¡¹æŠ€æœ¯è®©ç¼–è¯‘å™¨å¯¹æ­¤ä¼˜åŒ–ï¼Œçœç•¥å…¶ä¸­çš„æ‹·è´æ„é€ ç¯èŠ‚ï¼Œè¾¾åˆ°æå‡æ•ˆç‡çš„ç›®çš„ã€‚</strong></p>
<p>ä¸€ä¸ª[å‚è€ƒé“¾æ¥](<a target="_blank" rel="noopener" href="https://blog.csdn.net/davidhopper/article/details/90696200">æµ…è°ˆC++11æ ‡å‡†ä¸­çš„å¤åˆ¶çœç•¥ï¼ˆcopy elisionï¼Œä¹Ÿå«RVOè¿”å›å€¼ä¼˜åŒ–ï¼‰_çŸ¥è¡Œåˆä¸€2018çš„åšå®¢-CSDNåšå®¢_c++11 rvo</a>)ã€‚</p>
<h2 id="Lecture-13-Move-Semantics"><a href="#Lecture-13-Move-Semantics" class="headerlink" title="Lecture 13: Move Semantics"></a>Lecture 13: Move Semantics</h2><h3 id="std-vector-lt-T-Allocator-gt-emplace-back"><a href="#std-vector-lt-T-Allocator-gt-emplace-back" class="headerlink" title="std: :vector&lt;T,Allocator&gt;: :emplace_back"></a>std: :vector&lt;T,Allocator&gt;: :emplace_back</h3><p>ä½œç”¨ï¼šå½“å‘<code>vector</code>æ’å…¥å…ƒç´ æ—¶ï¼Œå¯ä»¥é¿å…é¢å¤–åˆ›å»ºå¯¹è±¡ã€‚ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Referece link:https://en.cppreference.com/w/cpp/container/vector/emplace_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">President</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    std::string name;</span><br><span class="line">    std::string country;</span><br><span class="line">    <span class="keyword">int</span> year;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">President</span>(std::string p_name, std::string p_country, <span class="keyword">int</span> p_year)</span><br><span class="line">        : <span class="built_in">name</span>(std::<span class="built_in">move</span>(p_name)), <span class="built_in">country</span>(std::<span class="built_in">move</span>(p_country)), <span class="built_in">year</span>(p_year)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;I am being constructed.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">President</span>(President&amp;&amp; other)</span><br><span class="line">        : <span class="built_in">name</span>(std::<span class="built_in">move</span>(other.name)), <span class="built_in">country</span>(std::<span class="built_in">move</span>(other.country)), <span class="built_in">year</span>(other.year)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;I am being moved.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    President&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> President&amp; other) = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector&lt;President&gt; reElections;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\npush_back:\n&quot;</span>;</span><br><span class="line">    reElections.<span class="built_in">push_back</span>(<span class="built_in">President</span>(<span class="string">&quot;Franklin Delano Roosevelt&quot;</span>, <span class="string">&quot;the USA&quot;</span>, <span class="number">1936</span>));</span><br><span class="line">    <span class="comment">// é€šå¸¸push_backçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè‡ªå·±åˆ›å»ºä¸€ä¸ªè¦æ’å…¥çš„å…ƒç´ å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// ä½†é€šè¿‡ä½¿ç”¨emplace_backï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ä½¿ç”¨è¿™ä¸€æ“ä½œï¼Œå½“æ’å…¥æ—¶ï¼Œvectorä¼šä¸ºæˆ‘ä»¬åˆ›å»ºå¯¹åº”çš„å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    std::vector&lt;President&gt; elections;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;emplace_back:\n&quot;</span>;</span><br><span class="line">    <span class="keyword">auto</span>&amp; ref = elections.<span class="built_in">emplace_back</span>(<span class="string">&quot;Nelson Mandela&quot;</span>, <span class="string">&quot;South Africa&quot;</span>, <span class="number">1994</span>);</span><br><span class="line">    <span class="built_in">assert</span>(ref.year == <span class="number">1994</span> &amp;&amp; <span class="string">&quot;uses a reference to the created object (C++17)&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="lvalues-and-rvalues"><a href="#lvalues-and-rvalues" class="headerlink" title="lvalues and rvalues"></a>lvalues and rvalues</h3><p>å’Œå³å€¼çš„å®šä¹‰ã€‚</p>
<p><strong>åŸºæœ¬å®šä¹‰</strong></p>
<ul>
<li>å·¦å€¼ï¼ˆlvaluesï¼‰æ˜¯å…·æœ‰åç§°ï¼ˆèº«ä»½ï¼‰çš„è¡¨è¾¾å¼ã€‚<ul>
<li>å¯ä»¥ä½¿ç”¨åœ°å€è¿ç®—ç¬¦ï¼ˆ&amp;varï¼‰æŸ¥æ‰¾åœ°å€</li>
</ul>
</li>
<li>å³å€¼ï¼ˆrvaluesï¼‰æ˜¯æ²¡æœ‰åç§°ï¼ˆèº«ä»½ï¼‰çš„è¡¨è¾¾å¼ã€‚<ul>
<li>ä¸´æ—¶å€¼</li>
<li>ä½¿ç”¨åœ°å€è¿ç®—ç¬¦ï¼ˆ&amp;varï¼‰æ‰¾ä¸åˆ°åœ°å€</li>
</ul>
</li>
</ul>
<p>ç›´è§‚ä½†æŠ€æœ¯ä¸Šå¹¶ä¸æ­£ç¡®çš„ç†è§£ï¼šå·¦å€¼å¯ä»¥å‡ºç°åœ¨èµ‹å€¼çš„ä¸¤ä¾§ï¼Œä½†å³å€¼é€šå¸¸åªèƒ½å‡ºç°åœ¨èµ‹å€¼çš„å³ä¾§ã€‚</p>
<p><strong>ä»£ç ä¾‹å­</strong></p>
<p>ä»¥ä¸‹æ¯ä¸ªè¡¨è¾¾å¼çš„å€¼ç±»åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> val = <span class="number">2</span>;					<span class="comment">// lvalue = rvalue</span></span><br><span class="line"><span class="keyword">int</span>* ptr = <span class="number">0x02248837</span>;			<span class="comment">// lvalue = rvalue</span></span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; v1&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;		<span class="comment">// v1 = &#123;1, 2, 3&#125;, lvalue = rvalue</span></span><br><span class="line"><span class="keyword">auto</span> v4 = v1 + V2;				<span class="comment">// lvalue = rvalue</span></span><br><span class="line">V1 += v4;			 			<span class="comment">// lvalue += lvalue</span></span><br><span class="line"><span class="keyword">size_t</span> size = v.<span class="built_in">size</span>();			<span class="comment">// lvalue = rvalue</span></span><br><span class="line">val = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(size); 	<span class="comment">// lvalue = rvalue (due to cast)</span></span><br><span class="line">v1 [<span class="number">1</span>] = <span class="number">4</span>*i;					<span class="comment">// lvalue = rvalue</span></span><br><span class="line">ptr = &amp;val;						<span class="comment">// lvalue = rvalue</span></span><br><span class="line">V1 [<span class="number">2</span>] = *ptr;					<span class="comment">// lvalue = lvalue</span></span><br></pre></td></tr></table></figure>

<p>å·¦å€¼å¼•ç”¨ä½¿ç”¨ä¸€ä¸ª<code>&amp;</code>å®šä¹‰ä¸å³å€¼å¼•ç”¨ç”¨ä¸¤ä¸ª<code>&amp;</code>å®šä¹‰ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> val = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">int</span>* ptr = <span class="number">0x02248837</span>;</span><br><span class="line">vectorsint&gt; v1&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span>&amp; ptr2 = ptr;				<span class="comment">// ptr2 is an l-value reference</span></span><br><span class="line"><span class="keyword">auto</span>&amp;&amp; v4 = v1 + v2;			<span class="comment">// v4 is an r-value reference</span></span><br><span class="line"><span class="keyword">auto</span>&amp; ptr3 = &amp;val;				<span class="comment">// ERROR: can&#x27;t bind l-val ref to r-value</span></span><br><span class="line"><span class="keyword">auto</span>&amp;&amp; val2 = val;				<span class="comment">// ErROR: can&#x27;t bind r-val ref to l-value</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">auto</span>&amp; ptr3 = ptr + <span class="number">5</span>;		<span class="comment">// OKAY: CAN bind const l-val ref to r-value (WHY?)</span></span><br><span class="line"><span class="comment">// ä¸Šä¸€è¡Œä»£ç æ„å‘³ç€å°†ä¸€ä¸ªå³å€¼å­˜å‚¨åˆ°ptr3è¿™ä¸ªå˜é‡ä¸­</span></span><br><span class="line"><span class="comment">// 1.å› ä¸ºå³å€¼ä¸èƒ½è¢«ä¿®æ”¹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨constä¿®é¥°ï¼Œæ‰€ä»¥ç¬¬7è¡Œä»£ç å‡ºé”™</span></span><br><span class="line"><span class="comment">// 2.åˆå› ä¸ºå·¦å€¼è·Ÿå³å€¼ä¸æ˜¯ä¸€ç±»ä¸œè¥¿ï¼Œæ‰€ä»¥ç¬¬8è¡Œä»£ç å‡ºé”™ï¼Œå¦‚æœè¿™ä¹ˆåšäº†ï¼Œç­‰äºæŠŠå·¦å€¼å˜æˆä¸€ä¸ªæ²¡æœ‰èº«ä»½ä¸´æ—¶å˜é‡</span></span><br><span class="line"><span class="comment">//   ä½†å·¦å€¼æ˜¯æœ‰èº«ä»½çš„ï¼Œå¯èƒ½è¿˜åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨äº†ï¼Œæ‰€ä»¥è¿™ä¹ˆåšä¸å¯¹</span></span><br></pre></td></tr></table></figure>

<p><strong>ä¸€ä¸ªC++çš„ç¼–è¯‘é”™è¯¯</strong></p>
<p>åœ¨å†™ä»£ç æ—¶ï¼Œå¯èƒ½ä¼šç¢°åˆ°é”™è¯¯ï¼š<code>&quot;Invalid non-const ref of type X&amp; from r-value of type X&quot;</code>ã€‚ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">nocos_Lref</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; v)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">const_Lref</span><span class="params">(<span class="keyword">const</span> vector&lt;<span class="keyword">int</span>&gt;&amp; v)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">nocos_Rref</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp;&amp; v)</span> </span>;</span><br><span class="line"><span class="comment">// BTW: no one uses const Rref</span></span><br><span class="line"></span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; v1 = v2 + v3;			<span class="comment">// v1 is l-value</span></span><br><span class="line"><span class="built_in">nocos_Lref</span>(v1); 					<span class="comment">// OKAY: l-val reference binds to l-val</span></span><br><span class="line"><span class="built_in">nocos_Rref</span>(v1);						<span class="comment">// ERROR: r-val reference can&#x27;t bind to l-val</span></span><br><span class="line"><span class="built_in">nocos_Lref</span>(v2 + v3);				<span class="comment">// ERROR: l-val reference can&#x27;t bind to r-val</span></span><br><span class="line"><span class="built_in">const_Lref</span>(v2 + v3); 				<span class="comment">// OKAY: const l-val reference binds to r-val</span></span><br><span class="line"><span class="built_in">nocos_Rref</span>(v2 + v3);				<span class="comment">// OKAY: r-val reference binds to r-val</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ä¸»è¦é”™è¯¯å°±æ˜¯å˜é‡çš„å·¦å³å€¼ç»‘å®šé”™è¯¯ï¼Œå·¦å€¼å’Œå³å€¼å¼•ç”¨å¿…é¡»ä¸¥æ ¼å¯¹åº”å·¦å€¼å’Œå³å€¼ï¼Œå¦åˆ™å°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚è€Œå¦å¤–ä¸€ç§è§£å†³æ–¹æ³•æ˜¯å°†å‡½æ•°çš„å·¦å€¼å¼•ç”¨å‚æ•°ç”¨<code>const</code>ä¿®é¥°ï¼Œä»¥ç¡®ä¿å‡½æ•°ä¸ä¼šä¿®æ”¹å³å€¼ï¼ˆå› ä¸ºå³å€¼æ— æ³•é€šè¿‡åœ°å€è¿ç®—ç¬¦æ‰¾åˆ°åœ°å€ï¼Œä¸€èˆ¬ä¸èƒ½å‡ºç°åœ¨èµ‹å€¼çš„å·¦ä¾§ï¼‰ã€‚</p>
<p>è¿™é‡Œå…¶å®ä¹Ÿå›ç­”äº†è‡ªå·±ä¹‹å‰åœ¨CS106Bå­¦ä¹ é€’å½’æ—¶å€™æ‰€ç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œè‡ªå·±æœ‰æ—¶ä¼šå°†<code>v2+v3</code>è¿™ç§å³å€¼ä¼ å…¥é€’å½’å‡½æ•°ï¼Œä»¥é¿å…å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œæ–¹ä¾¿ä¹¦å†™ï¼Œä½†è¿™æ ·å°±ä¼šç¢°åˆ°ä»¥ä¸Šç±»å‹çš„æŠ¥é”™ã€‚è‡ªå·±åœ¨å†™çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ç¼–è¯‘é”™è¯¯æç¤ºï¼Œå‘ç°ç”¨<code>const</code>ä¿®é¥°å¯¹åº”å‚æ•°ï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½†æˆ‘æœ¬è´¨å¹¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦è¿™æ ·ã€‚æ ¹æ®è¿™é‡Œçš„å­¦ä¹ ï¼Œé—®é¢˜å°±å¯ä»¥å¾—åˆ°è§£ç­”ã€‚</p>
<h3 id="move-operations-c-11"><a href="#move-operations-c-11" class="headerlink" title="move operations(c++11)"></a>move operations(c++11)</h3><p>move semanticsçš„åŸºæœ¬æƒ³æ³•ï¼šå¦‚æœä¸€ä¸ªå˜é‡æ˜¯ä¸´æ—¶å˜é‡ï¼Œå…¶é©¬ä¸Šå°±è¦æ¶ˆå¤±ï¼Œé‚£æˆ‘ä»¬å¯ä»¥â€œå·å–â€å…¶èµ„æºã€‚æˆ‘ä»¬å¯ä»¥â€œå·å–â€å³å€¼çš„èµ„æºè€Œä¸å¯ä»¥â€œå·å–â€å·¦å€¼çš„èµ„æºï¼Œå› ä¸ºå³å€¼æœ¬è´¨æ˜¯ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œé©¬ä¸Šå°±ä¼šæ¶ˆå¤±ï¼Œè€Œå·¦å€¼æ˜¯æœ‰èº«ä»½çš„ï¼Œåœ¨ä»£ç è¿è¡Œæ—¶ä¼šä¸€ç›´å­˜åœ¨ã€‚å¦‚æœæˆ‘ä»¬æŠ•å–äº†å·¦å€¼çš„èµ„æºï¼Œé‚£åŸæœ‰å·¦å€¼å¯¹åº”çš„èµ„æºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ‰€ä»¥ï¼Œè¿™æ ·çš„æ“ä½œä¸è¢«å…è®¸ã€‚</p>
<p>ä¸ºä»€ä¹ˆå³å€¼æ˜¯move semanticsçš„å…³é”®ï¼Ÿ</p>
<ul>
<li>ä½œä¸ºå·¦å€¼çš„å¯¹è±¡ä¸æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥ä»ä¸­å¤åˆ¶ï¼Œä½†ç»å¯¹ä¸èƒ½ä»ä¸­ç§»åŠ¨ã€‚</li>
<li>ä½œä¸ºå³å€¼çš„å¯¹è±¡æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥å¤åˆ¶æˆ–ä»ä¸­ç§»åŠ¨ã€‚</li>
</ul>
<p>å…³é”®è§è§£ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡å¯èƒ½è¢«é‡ç”¨ï¼Œä½ å°±ä¸èƒ½çªƒå–å®ƒçš„èµ„æºã€‚ï¼ˆIf an object might potentially be reused, you cannot steal its resources.ï¼‰</p>
<p><strong>ä¸¤ä¸ªæ–°ç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼š</strong></p>
<ul>
<li>Move Instructor (create new from existing r-value)</li>
<li>Move assignment (overwrite existing from existing r-value)</li>
</ul>
<p>ç‰¹æ®Šæˆå‘˜å‡½æ•°çš„å‡½æ•°ç­¾åå¯¹æ¯”ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">StringVector</span>();												<span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="built_in">StringVector</span>(<span class="keyword">const</span> StringVector&amp; other) <span class="keyword">noexcept</span>;			<span class="comment">// æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">StringVector&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> StringVector&amp; rhs) <span class="keyword">noexcept</span>;	<span class="comment">// æ‹·è´èµ‹å€¼</span></span><br><span class="line">~<span class="built_in">StringVector</span>();											<span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">StringVector</span>(StringVector&amp;&amp; other) <span class="keyword">noexcept</span>;				<span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">StringVector&amp; <span class="keyword">operator</span>=(StrinqVector&amp;&amp; rhs) <span class="keyword">noexcept</span>;		<span class="comment">// ç§»åŠ¨èµ‹å€¼</span></span><br></pre></td></tr></table></figure>

<p><strong>ç§»åŠ¨æ„é€ å‡½æ•°ä¸ç§»åŠ¨èµ‹å€¼</strong></p>
<p>ç§»åŠ¨æ„é€ å‡½æ•°çš„è¦ç‚¹ï¼š</p>
<ul>
<li>å°†å…¶ä»–å¯¹è±¡çš„å†…å®¹ä¼ é€åˆ°æœ¬å¯¹è±¡ï¼ˆTransfer the contents of other to this.ï¼‰<ul>
<li>å°½å¯èƒ½ç§»åŠ¨è€Œä¸æ˜¯å¤åˆ¶ï¼ï¼ˆMove instead of copy whenever possible !ï¼‰</li>
</ul>
</li>
<li>è®©å…¶ä»–å¯¹è±¡å¤„äºæœªç¡®å®šä½†æœ‰æ•ˆçš„çŠ¶æ€ï¼ˆLeave other in an undetermined but valid state.ï¼‰<ul>
<li>å¼ºçƒˆæ¨èï¼šå°†å…¶è®¾ç½®ä¸ºclassçš„é»˜è®¤å€¼ï¼ˆHighly recommended: set it to the default value of classï¼‰</li>
</ul>
</li>
</ul>
<p>ä¸€ä¸ªä»£ç ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Axess</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Axess</span> ()</span><br><span class="line">    <span class="comment">// other special member functions</span></span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Axess</span>(Axess&amp;&amp; other) : <span class="built_in">students</span>(other.students) &#123; &#125;</span><br><span class="line">    <span class="comment">// ç§»åŠ¨èµ‹å€¼</span></span><br><span class="line">    Axess&amp; <span class="keyword">operator</span>=(Axess&amp;&amp; rhs) &#123;</span><br><span class="line">    	students = rhs.students;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	vector&lt;Student&gt; sudents;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶ä»¥ä¸Šä»£ç æ˜¯ç”¨ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼çš„å¯¹åº”å‡½æ•°ç­¾åå†™çš„ï¼Œå…¶å°†<code>rhs</code>ç»‘å®šåˆ°å³å€¼ï¼Œä½†åœ¨å¯¹åº”çš„å‡½æ•°ä½œç”¨åŸŸä¸­å…¶è¿˜æ˜¯ä¸€ä¸ªå·¦å€¼ï¼ˆå› ä¸ºèƒ½é€šè¿‡å–åœ°å€ç¬¦æ‰¾åˆ°åœ°å€ï¼Œå…¶æœ‰å§“åå’Œèº«ä»½ï¼‰ã€‚ä»£ç <code>students = rhs.students;</code>ä»ç„¶ä¼šè¿›è¡Œæ‹·è´æ“ä½œã€‚å› è€Œï¼Œæˆ‘ä»¬éœ€è¦å°†å·¦å€¼å˜ä¸ºå³å€¼ï¼Œç›¸åº”çš„å‡½æ•°ä¸º<code>std::move</code>ã€‚å¯¹ä»¥ä¸Šä»£ç åšä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Axess</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Axess</span> ()</span><br><span class="line">    <span class="comment">// other special member functions</span></span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Axess</span>(Axess&amp;&amp; other) : <span class="built_in">students</span>(std::<span class="built_in">move</span>(other.students)) &#123; &#125;</span><br><span class="line">    <span class="comment">// ç§»åŠ¨èµ‹å€¼</span></span><br><span class="line">    Axess&amp; <span class="keyword">operator</span>=(Axess&amp;&amp; rhs) &#123;</span><br><span class="line">    	students = std::<span class="built_in">move</span>(rhs.students);</span><br><span class="line">        <span class="comment">// Note: move by itself does not actually move anything!</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	vector&lt;Student&gt; sudents;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>std::move</strong></p>
<p>åŸºæœ¬ä½œç”¨ï¼š<code>std::move</code>æ— æ¡ä»¶åœ°å°†å˜é‡è½¬æ¢ä¸ºå³å€¼ã€‚<code>std::move</code>çš„å…³é”®è¦ç‚¹ï¼š</p>
<ul>
<li>ç§»åŠ¨æ„é€ å‡½æ•°/èµ‹å€¼è¿ç®—ç¬¦å¿…é¡»æ‰§è¡Œæˆå‘˜ç§»åŠ¨</li>
<li>ä½œä¸ºå³å€¼å€¼å¼•ç”¨çš„å‚æ•°å®é™…ä¸Šæ˜¯å·¦å€¼</li>
<li><code>std::move</code>æ— æ¡ä»¶åœ°å°†è¡¨è¾¾å¼è½¬æ¢ä¸ºå³å€¼</li>
<li><code>std::move</code>æœ¬èº«ä¸ä¼šç§»åŠ¨ä»»ä½•ä¸œè¥¿</li>
<li>åœ¨<code>std::move</code>ç§»åŠ¨å¯¹è±¡ä¹‹åï¼Œä¸å†ä½¿ç”¨è¯¥å¯¹è±¡</li>
</ul>
<p><strong>å†™ä¸€ä¸ªæ³›å‹swapå‡½æ•°</strong></p>
<p>åŸºæœ¬ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">v1</span><span class="params">(<span class="string">&quot;En&quot;</span>, <span class="number">73837463</span>)</span></span>;</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">v2</span><span class="params">(<span class="string">&quot;Ito&quot;</span>, <span class="number">10000000</span>)</span></span>;</span><br><span class="line">    <span class="built_in">swap</span>(v1, v2);</span><br><span class="line"></span><br><span class="line">    Patient patient1&#123;<span class="string">&quot;Anna&quot;</span>, <span class="number">2</span>&#125;;</span><br><span class="line">    Patient patient2&#123;<span class="string">&quot;Avery&quot;</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    <span class="built_in">swap</span>(patient1, patient2);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç­”æ¡ˆä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(T&amp; a, T&amp; b)</span> </span>&#123;</span><br><span class="line">	<span class="function">T <span class="title">c</span><span class="params">(std::move(a))</span></span>;		<span class="comment">// move constructor</span></span><br><span class="line">    a = std::<span class="built_in">move</span>(b);		<span class="comment">// move assignment</span></span><br><span class="line">    b = std::<span class="built_in">move</span>(c);		<span class="comment">// move assignment</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>ä»£ç çš„æ¨¡æ‹Ÿè¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/crownz-sec/Blog_Source@master/Stanford-CS106L/swap.gif" alt="swap"></p>
<p>å›¾ä¸­çš„<code>c</code>æ˜¯æˆ‘ä»¬å£°æ˜çš„ä¸´æ—¶å˜é‡ã€‚ä»¥ä¸Šæ¨¡æ‹Ÿè¿‡ç¨‹å¾ˆæ˜æ˜¾åœ°ä½“ç°å‡ºäº†move semanticsçš„æœ¬è´¨â€”â€”è¢«<code>move</code>æ ‡è®°çš„å¯¹è±¡ï¼ˆå³å€¼ï¼‰çš„èµ„æºå°†ä¼šè¢«â€œå·å–â€ï¼Œä»¥é¿å…ä»¥å¾€åˆ›å»ºå¤šä¸ªå¯¹è±¡çš„è¿‡ç¨‹ï¼Œé™ä½å¼€é”€ã€‚</p>
<p><strong>å¼•å…¥ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼ä¹‹åçš„åŸºæœ¬è§„åˆ™</strong></p>
<ul>
<li>å¦‚æœä½ åœ¨æ˜¾å¼å®šä¹‰ï¼ˆæˆ–åˆ é™¤ï¼‰å¤åˆ¶æ„é€ å‡½æ•°ã€å¤åˆ¶èµ‹å€¼ã€ç§»åŠ¨æ„é€ å‡½æ•°ã€ç§»åŠ¨èµ‹å€¼æˆ–ææ„å‡½æ•°ä¸­æŸå‡ ä¸ªï¼Œåˆ™åº”å®šä¹‰ï¼ˆæˆ–åˆ é™¤ï¼‰æ‰€æœ‰äº”ä¸ªç‰¹æ®Šæˆå‘˜å‡½æ•°ã€‚</li>
<li>ä½ å®šä¹‰ç‰¹æ®Šæˆå‘˜å‡½æ•°å…¶ä¸­ä¹‹ä¸€çš„äº‹å®æ„å‘³ç€ä½ çš„ç±»æˆå‘˜ä¹‹ä¸€å­˜åœ¨éœ€è¦è§£å†³çš„æ‰€æœ‰æƒé—®é¢˜ã€‚</li>
</ul>
<h2 id="Lecture-14-Inheritance"><a href="#Lecture-14-Inheritance" class="headerlink" title="Lecture 14: Inheritance"></a>Lecture 14: Inheritance</h2><h3 id="Namespaces"><a href="#Namespaces" class="headerlink" title="Namespaces"></a>Namespaces</h3><p>å› ä¸ºæ ‡å‡†åº“ä½¿ç”¨é€šç”¨åç§°ï¼Œä¾‹å¦‚stringï¼Œmaxï¼Œcountç­‰ï¼Œè¿™ä½¿å¾—åº“çš„åå­—å¾ˆå®¹æ˜“å‘ç”Ÿå†²çªã€‚å¤§éƒ¨åˆ†ç°ä»£è¯­è¨€ä½¿ç”¨namespaceså»è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p>
<p>Pythonä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generate a random number in Python</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(random.random())		<span class="comment"># å‡½æ•°å‰é¢éœ€è¦åŠ ä¸Šåº“å</span></span><br></pre></td></tr></table></figure>

<p>C++ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Count how many times value appears in C++</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::<span class="built_in">count</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªæ›´åŠ å…¨é¢çš„C++ä»£ç ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//using namespace std;</span></span><br><span class="line"><span class="keyword">using</span> std::vector; </span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Lecture &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">count</span> <span class="params">(<span class="keyword">const</span> vector&lt;<span class="keyword">int</span>&gt;&amp; v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ctr = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> i : v) &#123; </span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">                ++ctr;  </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ctr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	vector&lt;<span class="keyword">int</span>&gt; v&#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> i : v) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">            ++count;  </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;manual count: &quot;</span> &lt;&lt; count &lt;&lt; endl;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;lecture count: &quot;</span> &lt;&lt; Lecture::<span class="built_in">count</span>(v) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;algorithm count: &quot;</span> &lt;&lt; std::<span class="built_in">count</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), <span class="number">1</span>) &lt;&lt; endl;              </span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç æç¤ºæˆ‘ä»¬æœ€å¥½ä¸è¦åœ¨æ–‡ä»¶å¼€å¤´ä½¿ç”¨<code>using namespace std</code>ï¼Œä»¥é¿å…ä½œç”¨åå­—å†²çªçš„é—®é¢˜ã€‚ä¸ºäº†å…¼é¡¾ä»£ç çš„å¯é æ€§å’Œæ˜“ç¼–å†™æ€§ï¼Œå¯ä»¥åœ¨å¤´æ–‡ä»¶å¼€å¤´åªå¼•å…¥æˆ‘ä»¬æ‰€éœ€è¦çš„å‘½åç©ºé—´ã€‚ä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªç›¸åŒçš„åå­—ï¼Œå³ä¾¿åœ¨å¼€å¤´å¼•å…¥äº†å¯¹åº”çš„å‘½åç©ºé—´ï¼Œåœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œä¹Ÿå¿…é¡»åŠ ä¸Šå¯¹åº”çš„ä½œç”¨åŸŸå£°æ˜ï¼Œå¦åˆ™ï¼Œè¿˜æ˜¯ä¼šå‘ç”Ÿå‘½åç©ºé—´å†²çªã€‚</p>
<p><strong>Scope Resolution</strong></p>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬æ‰€æœ‰çš„ç±»æˆå‘˜å‡½æ•°å‰é¢å†™<code>ClassName::</code>ï¼Ÿ</p>
<p>è¿™æ˜¯ä¸ºäº†è®©ä¾¿ç¼–è¯‘å™¨çŸ¥é“æˆ‘ä»¬åœ¨ä¸ºå“ªä¸ªç±»å®šä¹‰å‡½æ•°ï¼</p>
<h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><p>åŠ¨æœºï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span> <span class="params">(ifstream &amp;stream, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do some stuff</span></span><br><span class="line">    stream &lt;&lt; i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span> <span class="params">(istringstream &amp;stream, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do some stuff</span></span><br><span class="line">    stream &lt;&lt; i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä¸¤ä¸ªå‡½æ•°æ‰€åšäº‹æƒ…éƒ½éå¸¸ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½å°‘å†™ä¸€ç‚¹ä»£ç ï¼Ÿ</p>
<p>å°è¯•1ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> StreamType&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span> <span class="params">(StreamType&amp; stream, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do some stuff</span></span><br><span class="line">    stream &lt;&lt; i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å¯ä»¥å·¥ä½œï¼Œå› ä¸ºæ¨¡æ¿ä½¿ç”¨<strong>éšå¼æ¥å£</strong>çš„æ¦‚å¿µã€‚è¯·æ³¨æ„ï¼Œæ²¡æœ‰éœ€è¦å“ªäº›è¿ç®—ç¬¦/å‡½æ•°çš„åˆ—è¡¨ã€‚</p>
<p>å¦‚æœå­˜åœ¨éšå¼æ¥å£ï¼Œåˆ™å¿…é¡»æœ‰<strong>æ˜¾å¼æ¥å£</strong>ã€‚é€šå¸¸åªç§°ä¸º<strong>æ¥å£</strong>ï¼Œè¿™æ˜¯æœ€ç®€å•çš„ç»§æ‰¿å½¢å¼ã€‚</p>
<p> <strong>Javaä¸C++çš„ä»£ç å¯¹æ¯”</strong></p>
<p>Javaä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Drink</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tea</span> <span class="keyword">implements</span> <span class="title">Drink</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// implementation</span></span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>C++ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Drink</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tea</span>:</span> <span class="keyword">public</span> Drink &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">make</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// implementation</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬çŸ¥é“C++ä¸­æ²¡æœ‰interfaceå…³é”®å­—ã€‚åœ¨C++ä¸­ï¼Œä¸€ä¸ªç±»ä½œä¸ºä¸€ä¸ªæ¥å£ï¼Œå…¶å¿…é¡»åªåŒ…å«<strong>çº¯è™šå‡½æ•°</strong>ã€‚ ä¸ºäº†å®ç°ä¸€ä¸ªä¸ªæ¥å£ï¼Œä¸€ä¸ªç±»å¿…é¡»å®šä¹‰æ‰€æœ‰è¿™äº›è™šå‡½æ•°ã€‚è€Œå¦‚æœæˆ‘ä»¬ç¡®å®æƒ³åœ¨æˆ‘ä»¬çš„ç±»ä¸­å®šä¹‰ä¸€äº›å‡½æ•°æ—¶ï¼Œå¯ä»¥é€šè¿‡<strong>è™šå‡½æ•°</strong>è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚</p>
<p>å°è¯•2ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span> <span class="params">(istream &amp;stream, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// do some stuff </span></span><br><span class="line">    stream &lt;&lt; i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªè¦istreamå®ç°äº†printï¼ˆä½œä¸ºéè™šå‡½æ•°ï¼‰ï¼Œå¹¶ä¸”æ‰€æœ‰ç±»å‹çš„æµéƒ½ç»§æ‰¿è‡ªistreamï¼Œé‚£ä¹ˆå…¶å®ƒæµéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªprintå‡½æ•°ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å†™ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>å¤‡æ³¨ï¼šæ²¡æœ‰â€œè™šæ‹Ÿâ€æˆå‘˜â€”â€”ç›¸åï¼Œå¦‚æœä¸€ä¸ªæˆå‘˜ä¸ç»§æ‰¿çš„æˆå‘˜åŒåï¼Œå­ç±»å°†éšè—çˆ¶ç±»çš„æˆå‘˜ã€‚ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> a;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> :</span> <span class="keyword">public</span> A &#123;</span><br><span class="line">	<span class="keyword">double</span> a: <span class="comment">// Hides A::a</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æœ€åæ˜¯structè·Ÿclassçš„å¯¹æ¯”ã€‚</p>
<p>å¦å¤–ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ C++ä¸­çš„structå…¶å®å‡ ä¹ç­‰åŒäºç±»ï¼Œåªæ˜¯classçš„æˆå‘˜å˜é‡é»˜è®¤æ˜¯privateï¼Œstructçš„æˆå‘˜å˜é‡é»˜è®¤æ˜¯publicã€‚<a href="%5B%E4%B8%BA%E4%BB%80%E4%B9%88struct%E9%BB%98%E8%AE%A4%E6%98%AFpublic,%E8%80%8Cclass%E9%BB%98%E8%AE%A4%E6%98%AFprivate?_%E6%98%8E%E6%9C%88%E6%B8%85%E9%A3%8E-%E7%B2%BE%E8%BF%9B%E4%B8%8D%E6%AD%A2%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2_struct%E7%9A%84%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%8F%AA%E8%83%BD%E6%98%AFpublic%5D(https://blog.csdn.net/xiaxiaojing/article/details/79398299)">å‚è€ƒé“¾æ¥</a></p>
<h2 id="Lecture-15-Inheritance-and-Template"><a href="#Lecture-15-Inheritance-and-Template" class="headerlink" title="Lecture 15: Inheritance and Template"></a>Lecture 15: Inheritance and Template</h2><h3 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h3><p><strong>è™šå‡½æ•°ä¸çº¯è™šå‡½æ•°</strong></p>
<p>å¦‚æœä¸€ä¸ªç±»è‡³å°‘æœ‰ä¸€ä¸ªçº¯è™šå‡½æ•°ï¼Œåˆ™ç§°ä¸ºæŠ½è±¡ç±»ã€‚ ï¼ˆæ¥å£æ˜¯æŠ½è±¡ç±»çš„å­é›†ã€‚ï¼‰æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚ä»£ç ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>= <span class="number">0</span>; 		<span class="comment">// pure virtual function</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">foo2</span><span class="params">()</span> </span>;    		<span class="comment">// non-pure virtual function</span></span><br><span class="line"> 	<span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">()</span> </span>= &#123; <span class="keyword">return</span> <span class="number">42</span>; &#125;;	<span class="comment">// regular function</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¸­çš„çº¯è™šå‡½æ•°è¢«æ‰€ç»§æ‰¿çš„ç±»å®ç°ã€‚éçº¯è™šå‡½æ•°æ˜¯æŒ‡ï¼Œæˆ‘åœ¨å½“å‰ç±»å®ç°äº†ä¸€ä¸ªé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœæˆ‘çš„æ´¾ç”Ÿç±»æƒ³è¦ä¸åŒçš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œå®ƒä»¬å¯ä»¥è¿›è¡Œé‡å†™éçº¯è™šå‡½æ•°ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­£å¸¸çš„å‡½æ•°ä¹Ÿå¯ä»¥è¢«é‡å†™ï¼Œä½†è¿™å¹¶ä¸é“å¾·ã€‚<a target="_blank" rel="noopener" href="https://isocpp.org/wiki/faq/strange-inheritance#redefining-nonvirtuals">å‚è€ƒ</a></p>
<p><strong>ä¸ç»§æ‰¿ç›¸å…³çš„ä¸€äº›å®šä¹‰</strong></p>
<p>åŸºç±»ï¼ˆBaseï¼Œåˆåè¶…ç±»ï¼ˆsuperclassï¼‰æˆ–çˆ¶ç±»ï¼ˆparentï¼‰ï¼‰ï¼šè¢«ç»§æ‰¿çš„ç±»</p>
<p>æ´¾ç”Ÿç±»ï¼ˆDerivedï¼Œåˆåå­ç±»ï¼ˆsubclassï¼Œchildï¼‰ï¼‰ï¼šä»åŸºç±»ç»§æ‰¿çš„ç±»</p>
<p><strong>æ„é€ å‡½æ•°</strong></p>
<p>å­ç±»æ€»æ˜¯è°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™è°ƒç”¨åŸºç±»çš„é»˜è®¤æ„é€ å‡½æ•°ã€‚</p>
<p><strong>ææ„å‡½æ•°</strong></p>
<p>å¦‚æœä½ æ‰“ç®—ä½¿ä½ çš„ç±»å¯ç»§æ‰¿ï¼ˆå³ï¼Œå¦‚æœæ‚¨çš„ç±»å…·æœ‰ä»»ä½•è™šå‡½æ•°ï¼‰ï¼Œè¯·å°†æ‚¨çš„ææ„å‡½æ•°è®¾ä¸ºè™šå‡½æ•°ï¼è¯­æ³•ï¼š<code>virtual ~Base () &#123;&#125;</code>ã€‚å¦åˆ™å‡ ä¹è‚¯å®šä¼šæœ‰å†…å­˜æ³„æ¼ã€‚</p>
<p><strong>å¤‡æ³¨ï¼šææ„å‡½æ•°æ˜¯å¦æ˜¯è™šæ‹Ÿçš„å¾ˆå¥½åœ°è¡¨æ˜äº†ä¸€ä¸ªç±»æ˜¯å¦æ‰“ç®—è¢«ç»§æ‰¿ã€‚</strong></p>
<p>éè™šæ‹Ÿææ„å‡½æ•°çš„ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> &#123;</span></span><br><span class="line">	~<span class="built_in">Base</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span>:</span> <span class="keyword">public</span> Base &#123;</span><br><span class="line">	~<span class="built_in">Derived</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Base *b = <span class="keyword">new</span> <span class="built_in">Derived</span>();</span><br><span class="line"><span class="keyword">delete</span> b;					<span class="comment">// Never calls the destructor for Derived!</span></span><br></pre></td></tr></table></figure>

<p><strong>è®¿é—®è¯´æ˜ç¬¦</strong></p>
<ul>
<li><code>private</code>ï¼šåªèƒ½è¢«è¿™ä¸ªç±»è®¿é—®</li>
<li><code>protected</code>ï¼šåªèƒ½ç”±æ­¤ç±»æˆ–æ´¾ç”Ÿç±»è®¿é—®</li>
<li><code>public</code>ï¼šä»»ä½•äººéƒ½å¯ä»¥è®¿é—®</li>
</ul>
<p>ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Drink</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Drink</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Drink</span>(std::string flavor) : <span class="built_in">flavor</span> (flavor) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">make</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	cout &lt;&lt; <span class="string">&quot;Made tea from the Drink class!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Drink</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	std::string flavor;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tea</span>:</span> <span class="keyword">public</span> Drink &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Tea</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Tea</span>(std::string flavor) : <span class="built_in">Drink</span>(flavor) &#123;&#125;</span><br><span class="line">    ~<span class="built_in">Tea</span>() = <span class="keyword">default</span>;	<span class="comment">// final classï¼Œæ²¡æœ‰äººç»§æ‰¿å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸æƒ³è®©å®ƒæˆä¸ºè™šå‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">make</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    	cout &lt;&lt; <span class="string">&#x27;Made tea from the Tea class!&quot; &lt;&lt; endl;</span></span><br><span class="line"><span class="string">	    // go get a cup</span></span><br><span class="line"><span class="string">    	// pour tea in</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">// Teaç»§æ‰¿Drinkï¼Œå¹¶é‡å†™makeå‡½æ•°</span></span><br></pre></td></tr></table></figure>

<h3 id="Templates-vs-Derived-Classes"><a href="#Templates-vs-Derived-Classes" class="headerlink" title="Templates vs Derived Classes"></a>Templates vs Derived Classes</h3><p>æ¨¡ç‰ˆæ˜¯é™æ€å¤šæ€æ€§ï¼Œå…¶åœ¨ç¼–è¯‘æ—¶æ¶ˆè€—èµ„æºï¼Œå®ç°å¤šæ€ï¼Œè€Œæ´¾ç”Ÿç±»æ˜¯åŠ¨æ€å¤šæ€æ€§ï¼Œå…¶åœ¨è¿è¡Œæ—¶æ¶ˆè€—èµ„æºï¼Œå®ç°å¤šæ€ã€‚æ€ä¹ˆå†³å®šä½¿ç”¨å“ªä¸€ä¸ªï¼Ÿ</p>
<p>ä½¿ç”¨æ¨¡ç‰ˆçš„æ—¶æœºï¼š</p>
<ul>
<li>è¿è¡Œæ—¶ï¼ˆruntimeï¼‰æ•ˆç‡æœ€é‡è¦</li>
<li>æ— æ³•å®šä¹‰å…¬å…±åŸºç±»</li>
</ul>
<p>ä½¿ç”¨æ´¾ç”Ÿç±»çš„æ—¶æœºï¼š</p>
<ul>
<li>ç¼–è¯‘æ—¶ï¼ˆcompile-timeï¼‰æ•ˆç‡æ˜¯æœ€é‡è¦çš„</li>
<li>æƒ³è¦éšè—å®ç°</li>
<li>ä¸å¸Œæœ›ä»£ç è†¨èƒ€ï¼ˆcode bloatï¼Œæ¨¡ç‰ˆä¼šåœ¨ç¼–è¯‘æ—¶ï¼Œç”Ÿæˆä¸åŒæ•°æ®ç±»å‹æ‰€å¯¹åº”çš„ç±»ï¼Œè¿™ä¼šå¢å¤§ä»£ç é‡ï¼‰</li>
</ul>
<p><strong>Casting</strong></p>
<p>Castingæ˜¯æŒ‡å¯¹æ•°æ®ç±»å‹è¿›è¡Œè½¬æ¢ã€‚ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// All of these are legal:</span></span><br><span class="line"><span class="keyword">int</span> a = (<span class="keyword">int</span>)b;</span><br><span class="line"><span class="keyword">int</span> a = <span class="built_in"><span class="keyword">int</span></span>(b);</span><br><span class="line"><span class="keyword">int</span> a = <span class="keyword">static</span> cast&lt;<span class="keyword">int</span>&gt;(b);</span><br><span class="line"><span class="comment">// Using static_cast is considered best practice (although many still use old style casts)</span></span><br></pre></td></tr></table></figure>

<h3 id="Template-Classes"><a href="#Template-Classes" class="headerlink" title="Template Classes"></a>Template Classes</h3><p><strong>å‡½æ•°æ¨¡æ¿</strong>æè¿°äº†å¦‚ä½•æ„å»ºä¸€ç³»åˆ—å¤–è§‚ç›¸ä¼¼çš„å‡½æ•°ï¼Œè€Œ<strong>ç±»æ¨¡æ¿</strong>æè¿°äº†å¦‚ä½•æ„å»ºä¸€ç³»åˆ—å¤–è§‚ç›¸ä¼¼çš„ç±»ã€‚ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œçš„è¯­æ³•è¡¨æ˜Cotaineråœ¨æ²¡æœ‰ç‰¹æ®Šå£°æ˜æ—¶ï¼Œé»˜è®¤ä¸ºstd::vector&lt;T&gt;</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="keyword">class</span> <span class="title">Container</span> =</span> std::vector&lt;T&gt;&gt;	</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Priority_Q</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Priority_Q</span>() = <span class="keyword">default</span>;</span><br><span class="line">	~<span class="built_in">Priority_Q</span>() = <span class="keyword">default</span>;</span><br><span class="line">	<span class="function">T <span class="title">top</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(T val)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="keyword">const</span> Priority_Q&amp; pq);</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	Container _heap;</span><br><span class="line">	<span class="keyword">size_t</span> _count&#123;<span class="number">0</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Priority_Q&lt;vector&lt;string&gt;, vector&lt;vector&lt;string&gt; &gt; &gt; queue;</span><br><span class="line">    queue.<span class="built_in">push</span>(&#123;&#125;);</span><br><span class="line">    queue.<span class="built_in">push</span>(&#123;&#125;);</span><br><span class="line">    queue.<span class="built_in">push</span>(&#123;&#125;);</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; queue &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Concepts-and-Constraints-C-20-å¤ä¹ "><a href="#Concepts-and-Constraints-C-20-å¤ä¹ " class="headerlink" title="Concepts and Constraints(C++20)å¤ä¹ "></a>Concepts and Constraints(C++20)å¤ä¹ </h3><p>C++20 å¼•å…¥äº†Constraintsç”¨äºåœ¨è¯­ä¹‰å±‚é¢å¯¹æ¨¡æ¿å‚æ•°è¿›è¡Œçº¦æŸã€‚è€ŒConcept å³ä¸ºä¸€ç³»åˆ—Constraintsçš„<strong>ç¬¦å·åç§°</strong>ï¼Œæ–¹ä¾¿é‡ç”¨Constraintsçš„é€»è¾‘ã€‚[å‚è€ƒé“¾æ¥](<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/351320730">Constraints &amp; concepts - çŸ¥ä¹ (zhihu.com)</a>)</p>
<p>ä¾‹å­ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Collection, <span class="keyword">typename</span> DataType&gt;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">countOccurences</span><span class="params">(<span class="keyword">const</span> Collection&lt;DataType&gt;&amp; list, DataType val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; list.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">	    <span class="keyword">if</span> (list[i] == val) ++count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç å«æœ‰éšå¼å€Ÿå£ï¼Œå…¶é»˜è®¤ä¼ å…¥çš„å¯¹è±¡æœ‰<code>size()</code>å‡½æ•°å’Œ<code>[]</code>æ“ä½œç¬¦ã€‚å¦‚æœä¼ å…¥çš„å¯¹è±¡æ²¡æœ‰å¯¹åº”çš„å‡½æ•°å’Œæ“ä½œç¬¦ï¼Œç¨‹åºå°†ä¼šæŠ¥å‡ºéå¸¸éš¾ä»¥ç†è§£çš„é”™è¯¯ã€‚å› è€Œå¼•å…¥äº†Constraintsï¼Œå®ƒæ˜¯å¯¹æ¨¡æ¿å‚æ•°çš„è¦æ±‚ï¼Œå…¶å…è®¸æˆ‘ä»¬å°†éšå¼æ¥å£è½¬æ¢ä¸ºæ˜¾å¼çš„è¦æ±‚ã€‚ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1-2è¡Œæ˜¯ç›¸åº”çš„Constraints</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> It, <span class="keyword">typename</span> Type&gt;</span><br><span class="line">  <span class="keyword">requires</span> Input_Iterator&lt;It&gt; &amp;&amp; Iterator_of&lt;It&gt; &amp;&amp; Equality_comparable&lt;Value_type&lt;It&gt;, Type&gt;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">countOccurences</span><span class="params">(It begin, It end, Type val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> iter = begin; iter != end; ++iter) &#123;</span><br><span class="line">	    <span class="keyword">if</span> (*iter == val) ++count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä½¿ç”¨Constraintsï¼Œå¦‚æœä½ æ‰€ä¼ å…¥çš„å‚æ•°ä¸æ»¡è¶³è¦æ±‚ï¼Œé‚£ä¹ˆä½ çš„ä»£ç å°†ä¼šåœ¨å®é™…è¿è¡Œä¹‹å‰ï¼Œé€šè¿‡Constraintsé‚£ä¸€éƒ¨åˆ†çš„ä»£ç æŠ›å‡ºé”™è¯¯ã€‚</p>
<p>Conceptï¼ˆæ¦‚å¿µï¼‰æ˜¯ä¸€ä¸ªè°“è¯ï¼Œå…¶åœ¨ç¼–è¯‘æ—¶è¯„ä¼°ï¼Œæ˜¯æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚ä»¥ä¸Šä»£ç çš„Concept:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> It, <span class="keyword">typename</span> Type&gt;</span><br><span class="line">  <span class="keyword">requires</span> Input_Iterator&lt;It&gt; &amp;&amp; Iterator_of&lt;It&gt; &amp;&amp; Equality_comparable&lt;Value_type&lt;It&gt;, Type&gt;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">countOccurences</span><span class="params">(It begin, It end, Type val)</span></span>;</span><br></pre></td></tr></table></figure>

<p>Conceptså’ŒConstraintså¯ä»¥ä¸ç±»æ¨¡æ¿ã€å‡½æ•°æ¨¡æ¿å’Œéæ¨¡æ¿å‡½æ•°ï¼ˆé€šå¸¸æ˜¯ç±»æ¨¡æ¿çš„æˆå‘˜ï¼‰ä¸€èµ·ä½¿ç”¨ã€‚æ ‡å‡†åº“æœ‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„Conceptsï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰ã€‚</p>
<p>Conceptçš„è¯¦ç»†[å‚è€ƒé“¾æ¥](<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/351320730">Constraints &amp; concepts - çŸ¥ä¹ (zhihu.com)</a>)ã€‚</p>
<h2 id="Lecture-16-RAII-and-Smart-Pointers"><a href="#Lecture-16-RAII-and-Smart-Pointers" class="headerlink" title="Lecture 16: RAII and Smart Pointers"></a>Lecture 16: RAII and Smart Pointers</h2><h3 id="å¯¼å¼•"><a href="#å¯¼å¼•" class="headerlink" title="å¯¼å¼•"></a>å¯¼å¼•</h3><p>ä¸€ä¸ªä»£ç ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">EvaluateSalaryAndReturnName</span> <span class="params">(<span class="keyword">int</span> idNumber)</span> </span>&#123;</span><br><span class="line">    Employee* e = <span class="keyword">new</span> <span class="built_in">Employee</span>(idNumber);</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="built_in">Title</span>() == <span class="string">&quot;CEO&quot;</span> || e.<span class="built_in">Salary</span>() &gt; <span class="number">100000</span>) &#123;</span><br><span class="line">		cout &lt;&lt; e.<span class="built_in">First</span>() &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">			&lt;&lt; e.<span class="built_in">Last</span>() &lt;&lt; <span class="string">&quot; is overpaid&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">auto</span> result = e.<span class="built_in">First</span>() + <span class="string">&quot; &quot;</span> + e.<span class="built_in">Last</span>();</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">delete</span> e;		<span class="comment">// what if we skip this line?</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ç»™å‡ºäº†ä¸€ä¸ªå¸¸è§çš„ä¾‹å­ï¼Œåœ¨å‡½æ•°å†…åˆå§‹åŒ–å¯¹è±¡ï¼Œç„¶ååœ¨å³å°†é€€å‡ºæ—¶ï¼Œå°†å…¶é”€æ¯ã€‚ä½†å®é™…ä¸Šï¼Œå‡½æ•°å¹¶ä¸æ˜¯æ€»ä¼šæŒ‰ç…§æˆ‘ä»¬é¢„æœŸçš„è¿›è¡Œï¼Œåè€Œï¼Œå‡½æ•°å¯èƒ½åœ¨ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ç”±äºå„ç§åŸå› æŠ›å‡ºå¼‚å¸¸ï¼Œè¿›è€Œç›´æ¥é€€å‡ºã€‚æ¯”å¦‚ï¼Œæ‰§è¡Œ<code>e.Title()</code>æ—¶ï¼Œå¦‚æœ<code>e</code>æ²¡æœ‰è¿™ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå‡½æ•°å°±ä¼šå› ä¸ºå¼‚å¸¸è€Œé€€å‡ºã€‚å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å¦‚æœé€šè¿‡è¿™ç§æ–¹å¼é€€å‡ºå‡½æ•°ï¼Œ<code>delete e</code>å¹¶æ²¡æœ‰å¾—åˆ°æ‰§è¡Œã€‚å› ä¸º<code>new</code>å…³é”®å­—åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œå³ä¾¿å½“å‰å‡½æ•°ç»ˆæ­¢è¿œè¡Œï¼Œå®ƒä»¬ä¹Ÿä»ç„¶ä¼šå­˜åœ¨äºå †ä¸Šï¼Œæ‰€ä»¥å¿…é¡»è‡ªå·±è¿›è¡Œé”€æ¯ã€‚æ‰€ä»¥ï¼Œä»¥ä¸Šä»£ç å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚</p>
<p><strong>æ›´ä¸€èˆ¬çš„è€ƒè™‘</strong></p>
<p>ä»¥ä¸‹å‡ ç§ç›¸å…³çš„C++èµ„æºéƒ½ä¸èµ„æºçš„å ç”¨å’Œå½’è¿˜ç›¸å…³ã€‚</p>
<table>
<thead>
<tr>
<th>èµ„æº</th>
<th>è·å–æ–¹å¼</th>
<th>é‡Šæ”¾æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td>Heap Memory</td>
<td>new</td>
<td>delete</td>
</tr>
<tr>
<td>Files</td>
<td>open</td>
<td>close</td>
</tr>
<tr>
<td>Locks</td>
<td>try_lock</td>
<td>unlock</td>
</tr>
<tr>
<td>Sockets</td>
<td>socket</td>
<td>close</td>
</tr>
</tbody></table>
<p><strong>Exception</strong></p>
<p>å¼‚å¸¸ï¼ˆExceptionï¼‰æ˜¯å°†æ§åˆ¶å’Œä¿¡æ¯ä¼ é€’ç»™ï¼ˆæ½œåœ¨çš„ï¼‰å¼‚å¸¸å¤„ç†ç¨‹åºçš„ä¸€ç§æ–¹å¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="comment">// code associated with exception handler</span></span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> ( [exception type] e ) &#123;</span><br><span class="line">	<span class="comment">// exception handler</span></span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> ( [exception type] e ) &#123;</span><br><span class="line">	<span class="comment">// exception handler</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¼ºåˆ¶å¼‚å¸¸å®‰å…¨</strong></p>
<p>å‡½æ•°å¯ä»¥æœ‰å››ä¸ªçº§åˆ«çš„å¼‚å¸¸å®‰å…¨ï¼š</p>
<ul>
<li>Nothrow exception guarantee<ul>
<li>ç»å¯¹ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œä¾‹å¦‚ï¼šææ„å‡½æ•°ã€äº¤æ¢ã€ç§»åŠ¨æ„é€ å‡½æ•°ç­‰ã€‚</li>
</ul>
</li>
<li>Strong exception guarantee<ul>
<li>å›æ»šåˆ°å‡½æ•°è°ƒç”¨ä¹‹å‰çš„çŠ¶æ€</li>
</ul>
</li>
<li>Basic exception guarantee<ul>
<li>å¼‚å¸¸åç¨‹åºå¤„äºæœ‰æ•ˆçŠ¶æ€</li>
</ul>
</li>
<li>No exception guarantee<ul>
<li>èµ„æºæ³„æ¼ã€å†…å­˜æŸåç­‰</li>
</ul>
</li>
</ul>
<p><strong>å®Œå…¨é¿å…å¼‚å¸¸</strong></p>
<p>åœ¨æŸç§æƒ…å†µä¸‹ï¼Œå…¶å®ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨å¼‚å¸¸ï¼Œæˆ–è€…è¯´é¡¹ç›®çš„ç°æœ‰è§„æ¨¡å¹¶ä¸æ”¯æŒä½ ä½¿ç”¨å¼‚å¸¸æ—¶ï¼Œéœ€è¦é¿å…ä½¿ç”¨å¼‚å¸¸ã€‚Googleå°±æ˜¯å¦‚æ­¤ï¼Œå®ƒä»¬çš„å¤§éƒ¨åˆ†ä»£ç éƒ½æ²¡æœ‰å‡†å¤‡å¥½ä½¿ç”¨å¼‚å¸¸ï¼Œæ‰€ä»¥å®ƒä»¬å†³å®šä¸€ç›´ä¸ä½¿ç”¨å¼‚å¸¸ï¼Œå¹¶ä½¿ç”¨å…¶ä»–æ›¿ä»£æ–¹æ³•ï¼ˆä¾‹å¦‚é”™è¯¯ä»£ç å’Œæ–­è¨€ï¼‰ã€‚[å‚è€ƒé“¾æ¥](<a target="_blank" rel="noopener" href="https://google.github.io/styleguide/cppguide.html#Exceptions">Google C++ Style Guide</a>)</p>
<blockquote>
<p>We forgot to do it initially, so letâ€™s not bother getting started.</p>
</blockquote>
<h3 id="RAII"><a href="#RAII" class="headerlink" title="RAII"></a>RAII</h3><p>RAIIå…¨ç§°ä¸º<strong>R</strong>esource <strong>A</strong>cquisition <strong>I</strong>s <strong>I</strong>nitializationï¼Œä¸­æ–‡åå«èµ„æºè·å–å³åˆå§‹åŒ–ï¼Œæ˜¯ä¸€ç§è®¾è®¡ç†å¿µã€‚å…¶å¯ç®€å•å½’çº³ä¸ºï¼šæ‰€æœ‰èµ„æºéƒ½åº”è¯¥åœ¨<strong>æ„é€ å‡½æ•°</strong>ä¸­è·å–ï¼Œæ‰€æœ‰èµ„æºéƒ½åº”è¯¥åœ¨<strong>ææ„å‡½æ•°</strong>ä¸­é‡Šæ”¾ã€‚å¦ä¸€ç§ç®€ç§°ä¸ºSBRMï¼Œå…¨ç§°ä¸º<strong>S</strong>cope <strong>B</strong>ased <strong>M</strong>emory <strong>M</strong>anageï¼Œè®²è¯¾è€å¸ˆå–œæ¬¢çš„ä¸€ç§å«æ³•CADREï¼ˆ<strong>C</strong>onstructor <strong>A</strong>cquires, <strong>D</strong>estructor <strong>Re</strong>leasesï¼‰ã€‚RAIIå°†é‡Šæ”¾èµ„æºçš„ä»£ç æ”¾åˆ°ææ„å‡½æ•°ï¼Œè¿™æ ·æ— è®ºä½ ä»¥ä½•ç§æ–¹å¼é€€å‡ºå‡½æ•°ï¼Œèµ„æºæ€»æ˜¯ä¼šè¢«é‡Šæ”¾ã€‚å› ä¸ºè„±ç¦»äº†å½“å‰å‡½æ•°çš„ä½œç”¨åŸŸï¼Œå¯¹è±¡å°†ä¸å¤å­˜åœ¨ï¼Œå› è€Œä¼šè°ƒç”¨ææ„å‡½æ•°ã€‚</p>
<p><strong>é‡‡ç”¨RAIIçš„ç†ç”±</strong></p>
<ul>
<li>å¯¹è±¡æ°¸è¿œä¸åº”è¯¥æœ‰â€œåŠæœ‰æ•ˆâ€çŠ¶æ€ã€‚å¯¹è±¡åº”è¯¥åœ¨åˆ›å»ºåå¯ç”¨ã€‚</li>
<li>ææ„å‡½æ•°æ€»æ˜¯ä¼šè¢«è°ƒç”¨ï¼ˆå³ä½¿æœ‰å¼‚å¸¸ï¼‰ï¼Œæ‰€ä»¥èµ„æºæ€»æ˜¯ä¼šè¢«é‡Šæ”¾çš„ã€‚</li>
</ul>
<p><strong>ä¸€ä¸ªæ–‡ä»¶è¯»å†™ä¾‹å­</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">ifstream <span class="title">input</span><span class="params">()</span></span>;</span><br><span class="line">    input.<span class="built_in">open</span>(<span class="string">&quot;hamlet.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    string line;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">getline</span>(input, line)) &#123;</span><br><span class="line">    	cout &lt;&lt; line &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    input.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œèµ„æºå¹¶æœªåœ¨æ„é€ å‡½æ•°ä¸­è·å–æˆ–åœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾ã€‚å› ä¸ºä»¥ä¸Šæ˜¯å…ˆåˆ›å»ºæ–‡ä»¶æµå¯¹è±¡ï¼Œä¹‹åæ‰ä½¿ç”¨<code>open()</code>å»åˆ›å»ºå…·ä½“å¯¹è±¡ã€‚åŒæ—¶ï¼Œ<code>close()</code>ä¹Ÿåªæ˜¯åœ¨ææ„å‡½æ•°å‡½æ•°å¤–éƒ¨ä½¿ç”¨ã€‚è¿™æ˜¯ä¸ç¬¦åˆRAIIçš„ä»£ç ï¼Œä½†è¿™åè€Œæ˜¯æˆ‘å­¦åˆšå¼€å§‹C++æ—¶ï¼Œè€å¸ˆåå¤å¼ºè°ƒçš„å†™æ³•ï¼Œå…ˆ<code>open()</code>ï¼Œæœ€åå†<code>close()</code>ã€‚</p>
<p>æ­£ç¡®å†™æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printFile</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">ifstream <span class="title">input</span><span class="params">(<span class="string">&quot;hamlet.txt&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    string line;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">getline</span>(input, line)) &#123; <span class="comment">// might throw exception</span></span><br><span class="line">    	cout &lt;&lt; line &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// no close call needed!</span></span><br><span class="line">&#125;<span class="comment">// stream destructor, releases access to file</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œæ–‡ä»¶æµå¯¹è±¡çš„ææ„å‡½æ•°å·²ç»å†™å¥½äº†é‡Šæ”¾èµ„æºçš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰å¿…è¦å†ä½¿ç”¨<code>close()</code>ã€‚æ‰€ä»¥ï¼Œåœ¨é”™è¯¯ä»£ç é‡Œé¢ï¼Œä»£ç æ•´ä½“å€’ä¹Ÿæ²¡æœ‰å†…å­˜æ³„æ¼çš„é£é™©ï¼Œåªæ˜¯æœ€åçš„<code>close()</code>æ˜¾å¾—å¾ˆå¤šä½™ï¼Œä¸”ä¸ç¬¦åˆRAIIé€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡çš„æ€æƒ³ã€‚</p>
<p><strong>ä¸€ä¸ªé”ä¾‹å­</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cleanDatabase</span><span class="params">(mutex&amp; databaseLock,</span></span></span><br><span class="line"><span class="params"><span class="function">				map&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; database)</span></span>&#123;</span><br><span class="line">    databaseLock.<span class="built_in">lock</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// other threads will not modify database</span></span><br><span class="line">    <span class="comment">// modify the database</span></span><br><span class="line">    <span class="comment">// if exception thrown, mutex never unlocked!</span></span><br><span class="line">    </span><br><span class="line">    databaseLock.<span class="built_in">unlock</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ä»ç„¶æ˜¯ä¼ ç»Ÿçš„æ€æƒ³ï¼Œå…ˆåŠ é”ï¼Œè¯»å†™å®Œä¹‹åï¼Œå†é‡Šæ”¾é”ï¼Œè¿™æ¬¡åˆè·Ÿæˆ‘æ“ä½œç³»ç»Ÿè€å¸ˆè®²çš„ä¸€æ ·äº†ï¼ˆ<del>å…¶æ°´å¹³æä½</del>ï¼‰ã€‚æ­£ç¡®çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cleanDatabase</span><span class="params">(mutex&amp; databaseLock,</span></span></span><br><span class="line"><span class="params"><span class="function">				map&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; database)</span> </span>&#123;</span><br><span class="line">    lock_guard&lt;mutex&gt;(databaseLock);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// other threads will not modify database</span></span><br><span class="line">    <span class="comment">// modify the database</span></span><br><span class="line">    <span class="comment">// if exception thrown, that&#x27;s fine!</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// no release call needed</span></span><br><span class="line">&#125; <span class="comment">// lock always unlocked when function exits .</span></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ä½¿å¾—å‡½æ•°æ— è®ºä»¥ä½•ç§æ–¹å¼é€€å‡ºï¼Œé”æ€»æ˜¯ä¼šè¢«é‡Šæ”¾ã€‚</p>
<p><strong>lock_guardçš„éæ¨¡ç‰ˆå®ç°æ–¹å¼</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lock_guard</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">lock_guard</span>(mutex&amp; lock) : <span class="built_in">acquired_lock</span>(lock) &#123;</span><br><span class="line">    	acquired_lock.<span class="built_in">lock</span>()</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">lock_guard</span>() &#123;</span><br><span class="line">		acquired_lock.<span class="built_in">unlock</span>();</span><br><span class="line">	&#125; </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	mutex&amp; acquired_lock;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œä¸ºäº†ç¬¦åˆRAIIè¿™ç§æ€æƒ³ï¼Œæˆ‘ä»¬æ‰€åšçš„å…¶å®å°±æ˜¯å¯¹èµ„æºçš„ç”³è¯·å’Œé‡Šæ”¾è¿›è¡Œå°è£…ï¼Œç¡®ä¿å¯¹è±¡è„±ç¦»å¯¹åº”ä½œç”¨åŸŸæ—¶ï¼Œå…¶å ç”¨çš„èµ„æºä¼šè¢«é‡Šæ”¾ã€‚åŒæ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯mutexesä¸èƒ½è¢«å¤åˆ¶å’Œç§»åŠ¨ï¼Œå› ä¸ºä»£ç ä¸­å·²ç»å°†å¯¹åº”çš„ç±»æ–¹æ³•è®¾ç½®ä¸º<code>delete</code>ï¼Œä¸€ä¸ªä»£ç ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mutex</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">mutex</span>(<span class="keyword">const</span> mutex&amp; other) = <span class="keyword">delete</span>;</span><br><span class="line">    mutex&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> mutex&amp; rhs) = <span class="keyword">delete</span>;</span><br><span class="line">    <span class="built_in">mutex</span>(mutex&amp;&amp; other) = <span class="keyword">delete</span>;</span><br><span class="line">    mutex&amp; <span class="keyword">operator</span>=(mutex&amp;&amp; other) = <span class="keyword">delete</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œåœ¨ä»¥ä¸Šå®ç°lock_guardç±»æ—¶ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡åˆè¯•åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–lock_guardçš„ã€‚</p>
<p><strong>æ€»ç»“</strong></p>
<p>åœ¨æ„é€ å‡½æ•°ä¸­è·å–èµ„æºï¼Œå¹¶åœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾ã€‚è¿™æ ·ï¼Œç±»çš„ä½¿ç”¨è€…è¿™å°±ä¸å¿…æ‹…å¿ƒèµ„æºçš„é”™è¯¯ç®¡ç†ã€‚</p>
<h3 id="Smart-Pointers"><a href="#Smart-Pointers" class="headerlink" title="Smart Pointers"></a>Smart Pointers</h3><p>ä¸€ä¸ªCS106Bçš„ä»£ç ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rawPtrFn</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    Node* n = <span class="keyword">new</span> Node;</span><br><span class="line">    <span class="comment">// I do some stuff with n...</span></span><br><span class="line">    <span class="comment">// if exception thrown, n never deleted!</span></span><br><span class="line">    <span class="keyword">delete</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ä»¥ä¸Šä»£ç å­˜åœ¨å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚C++å¼•å…¥æ™ºèƒ½æŒ‡é’ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¸¸è§çš„æ™ºèƒ½æŒ‡é’ˆå¦‚ä¸‹ï¼š</p>
<ul>
<li><code>std::unique_ptr</code></li>
<li><code>std::shared_ptr </code></li>
<li><code>std::weak_ptr</code></li>
</ul>
<p>æ³¨æ„ï¼š<code>auto_ptr</code>åœ¨C++98å¼•å…¥ï¼ŒC++11ä¸èµæˆä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨C++17ä¸­è¢«ç§»é™¤ã€‚æ‰€ä»¥ï¼Œä¸ºäº†å‘åå…¼å®¹ï¼Œåº”é¿å…ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆã€‚</p>
<p><strong>unique_ptr(C++11)</strong></p>
<p>é€šè¿‡unique_ptræ”¹å†™ä»¥ä¸Šä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rawPtrEn</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::unique_ptr&lt;Node&gt; <span class="title">n</span> <span class="params">(<span class="keyword">new</span> Node)</span></span>;</span><br><span class="line">    <span class="comment">// do some stuff with n</span></span><br><span class="line">&#125; <span class="comment">// Freed!</span></span><br></pre></td></tr></table></figure>

<p>unique_pträ¸èƒ½è¢«å¤åˆ¶ã€‚å› ä¸ºå¦‚æœå…¶å…è®¸è¢«å¤åˆ¶çš„è¯ï¼Œå‡è®¾å¤åˆ¶ä¸€æ¬¡ï¼Œå°†ä¼šæœ‰ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªåœ°å€ï¼Œå½“ç¬¬ä¸€ä¸ªæŒ‡é’ˆè¢«é”€æ¯æ—¶ï¼Œå¯¹åº”åœ°å€çš„æ•°æ®å·²ç»è¢«ææ„å‡½æ•°é”€æ¯ï¼Œå½“ç¬¬äºŒä¸ªæŒ‡é’ˆè¢«é”€æ¯æ—¶ï¼ŒåŒæ ·ä¼šå°è¯•å¯¹åŒä¸€ä¸ªåœ°å€çš„æ•°æ®è¿›è¡Œé”€æ¯ï¼Œä½†æ˜¯æ•°æ®åœ¨ä¹‹å‰å·²ç»è¢«é”€æ¯è¿‡äº†ï¼Œæ‰€ä»¥é€ æˆäº†<code>double free</code>ã€‚æ€ä¹ˆå‘ŠçŸ¥ä¸€ä¸ªç±»ä¸å…è®¸å¤åˆ¶ï¼Ÿé€šè¿‡åˆ é™¤å¤åˆ¶æ„é€ å‡½æ•°å’Œå¤åˆ¶èµ‹å€¼å³å¯ï¼Œè¯­æ³•è·Ÿå‰é¢çš„mutexç±»ç›¸ä¸€è‡´ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ç»å¸¸å¸Œæœ›æœ‰å¤šä¸ªæŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆã€‚è¿™å°±å¼•å…¥shared_ptrã€‚</p>
<p><strong>shared_ptr(C++11)</strong></p>
<p>èµ„æºå¯ä»¥ç”±ä»»æ„æ•°é‡çš„shared_ptrå­˜å‚¨ï¼Œå½“èµ„æºæ²¡æœ‰ä»»ä½•ä¸€ä¸ªshared_ptræŒ‡å‘æ—¶ï¼Œå¯¹åº”èµ„æºè¢«åˆ é™¤ã€‚ä»£ç ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="function">std::shared_ptr&lt;<span class="keyword">int</span>&gt; <span class="title">p1</span> <span class="params">(<span class="keyword">new</span> <span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="comment">// Use p1</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::shared_ptr&lt;<span class="keyword">int</span>&gt; p2 = p1;</span><br><span class="line">        <span class="comment">// Use p1 and p2</span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// Use p1</span></span><br><span class="line">&#125;<span class="comment">// Freed!</span></span><br><span class="line"><span class="comment">// å½“ä¸”ä»…å½“ï¼Œæ–°çš„shared_ptræ˜¯é€šè¿‡æ‹·è´åˆ›å»ºæ—¶æ‰æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">// æ¢å¥è¯è¯´ï¼Œåœ¨åˆ›å»ºç¬¬ä¸€ä¸ªshared_pträ¹‹åï¼Œåç»­çš„åªèƒ½é€šè¿‡æ‹·è´åˆ›å»ºã€‚</span></span><br></pre></td></tr></table></figure>

<p>shared_ptrçš„å®ç°æ–¹å¼ï¼šå¼•ç”¨è®¡æ•°ï¼ˆReference countingï¼‰ã€‚</p>
<ul>
<li><p>åŸºæœ¬æƒ³æ³•ï¼šå­˜å‚¨ä¸€ä¸ª intï¼Œç”¨äºè·Ÿè¸ªå½“å‰å¼•ç”¨è¯¥æ•°æ®çš„æ•°å­—</p>
<ul>
<li><p>åœ¨æ‹·è´æ„é€ å‡½æ•°/æ‹·è´èµ‹å€¼ä¸­é€’å¢</p>
</li>
<li><p>åœ¨ææ„å‡½æ•°ä¸­æˆ–è¢«æ‹·è´è¦†ç›–æ—¶é€’å‡</p>
</li>
</ul>
</li>
<li><p>å½“å¼•ç”¨è®¡æ•°è¾¾åˆ° 0 æ—¶é‡Šæ”¾èµ„æº</p>
</li>
</ul>
<p>æ³¨æ„ï¼šå•ä¸ªå¯¹è±¡çš„shared_pträ½¿ç”¨ä»ç„¶æˆç«‹ï¼Œè¿™æ—¶çš„å¼•ç”¨è®¡æ•°ä¸º1ã€‚ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">rawPtrFn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="function">std::unique_ptr&lt;Node&gt; <span class="title">n</span> <span class="params">(<span class="keyword">new</span> Node)</span> </span>;</span><br><span class="line">	<span class="comment">// do some stuff with n</span></span><br><span class="line">&#125;<span class="comment">// Freed!</span></span><br></pre></td></tr></table></figure>

<p><strong>weak_ptr(C++11)</strong></p>
<p>weak_pträ¸shared_ptr ç±»ä¼¼ï¼Œä½†å…¶å¯¹å¼•ç”¨è®¡æ•°æ²¡æœ‰è´¡çŒ®ã€‚ç»å¸¸è¢«ç”¨äºå¤„ç† shared_ptr çš„å¾ªç¯å¼•ç”¨ï¼Œä¾‹å¦‚ï¼šå¾ªç¯é“¾è¡¨ã€‚åœ¨å¾ªç¯é“¾è¡¨ä¸­ï¼ŒæŒ‡å‘å‰é©±å’Œåç»§çš„æŒ‡é’ˆåº”è¯¥è¦ä½¿ç”¨weak_ptrï¼Œè€Œéshared_ptrã€‚å¯¹äºä¸€ä¸ªåŒ…å«2èŠ‚ç‚¹Aå’ŒBçš„å¾ªç¯é“¾è¡¨ï¼Œå¦‚æœä½¿ç”¨shared_ptrï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨è®¡æ•°éƒ½ä¸º2ï¼Œå½“æˆ‘ä»¬æƒ³åˆ é™¤BèŠ‚ç‚¹çš„èµ„æºæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å¼•ç”¨è®¡æ•°è®¾ç½®ä¸º1ï¼ˆè¿™æ ·å½“è„±ç¦»ä½œç”¨åŸŸæ—¶ï¼ŒæŒ‡é’ˆæ‰ä¼šé‡Šæ”¾èµ„æºï¼‰ã€‚ä¸ºæ­¤ï¼Œæˆ‘éœ€è¦å°†<code>A-&gt;next</code>é”€æ¯ï¼Œé”€æ¯<code>A-&gt;next</code>å°±éœ€è¦å…ˆå°†Aé”€æ¯ã€‚ä½†æƒ³é”€æ¯Aæ—¶ï¼Œåˆéœ€è¦é”€æ¯<code>B-&gt;prev</code>ï¼Œé”€æ¯<code>B-&gt;prev</code>åˆéœ€è¦é”€æ¯<code>B</code>ï¼Œè¿™å°†é™·å…¥å¾ªç¯ä¹‹ä¸­ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨weak_ptrï¼Œæˆ‘ä»¬ä»å¯é€šè¿‡<code>A-&gt;next</code>å’Œ<code>B-&gt;prev</code>å»è®¿é—®å¯¹åº”èŠ‚ç‚¹ï¼Œä½†è¿™äº›æŒ‡é’ˆå¹¶ä¸å½±å“å¼•ç”¨è®¡æ•°ï¼Œä¹Ÿå°±æ˜¯å®ƒä»¬åªæœ‰è§‚æµ‹æƒï¼Œä½†å…¶æœ¬èº«å¹¶æ²¡æœ‰å…±äº«èµ„æºã€‚è¿™æ ·ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨è®¡æ•°éƒ½ä¸º1ï¼Œå½“è„±ç¦»ä½œç”¨åŸŸï¼Œå¼•ç”¨è®¡æ•°å‡1ï¼Œèµ„æºå°†å¾—åˆ°é‡Šæ”¾ã€‚åŒæ—¶ï¼Œweak_ptrè¿˜å¯ä»¥ç”¨äºåœ¨å»¶è¿Ÿä½¿ç”¨ä¸»å¯¼æƒçš„åœºæ™¯, æ¯”å¦‚çº¿ç¨‹Aæ˜¯é‡è¦çš„ï¼Œåœ¨Aå®Œæˆä¹‹åBï¼ŒCçº¿ç¨‹å¯åšå¯ä¸åšã€‚è¿™æ—¶ï¼ŒBå’ŒCå°±å¯ä»¥ä½¿ç”¨weak_ptræ¥æ§åˆ¶ã€‚</p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/LLZK_/article/details/52431404">weak_ptrçš„ä½œç”¨åŠåº”ç”¨åœºæ™¯â€”â€”shared_ptrçš„å¾ªç¯å¼•ç”¨é—®é¢˜_LLZK_çš„åšå®¢-CSDNåšå®¢</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/DswCnblog/p/5628314.html">C++ 11 åˆ›å»ºå’Œä½¿ç”¨å…±äº« weak_ptr - æ»´æ°´ç“¦ - åšå®¢å›­ (cnblogs.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/234b818f289a">C++11æ™ºèƒ½æŒ‡é’ˆï¼ˆweak_ptrï¼‰ - ç®€ä¹¦ (jianshu.com)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/26851369">c++çš„å¼±å¼•ç”¨æŒ‡é’ˆåˆ°åº•æ˜¯ä¸ºä»€ä¹ˆç›®çš„å¼•å…¥çš„ï¼ŸåŸç†æ˜¯å’‹å›äº‹ - çŸ¥ä¹ (zhihu.com)</a></li>
</ol>
<p><strong>unique_pträ¸shared_ptrçš„åˆ›å»º</strong></p>
<p>åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„åˆ›å»ºæ–¹æ³•ä¸ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;Node&gt; <span class="title">n</span><span class="params">(<span class="keyword">new</span> Node)</span></span>;</span><br><span class="line"><span class="function">std::shared_ptr&lt;Node&gt; <span class="title">n</span><span class="params">(<span class="keyword">new</span> Node)</span></span>;</span><br></pre></td></tr></table></figure>

<p>ä½†ç°åœ¨ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨å†…ç½®çš„æ™ºèƒ½æŒ‡é’ˆåˆ›é€ å™¨ï¼Œä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;Node&gt; n = std::make_unique&lt;Node&gt;();</span><br><span class="line">std::shared_ptr&lt;Node&gt; n = std::make_shared&lt;Node&gt;();</span><br></pre></td></tr></table></figure>

<p>ç›¸å…³çš„ä¸‰æ¡è§„åˆ™ï¼š</p>
<ul>
<li><p>å‡½æ•°çš„å‚æ•°åœ¨å‡½æ•°ä¹‹å‰è¿›è¡Œè¯„ä¼°</p>
</li>
<li><p>æ¯ä¸ªå‡½æ•°éƒ½æ˜¯â€œåŸå­çš„â€</p>
</li>
<li><p><strong>è€Œå‚æ•°å¯èƒ½ä¼šä»¥å…¶ä»–æ–¹å¼äº¤é”™</strong></p>
<p>ï¼ˆæœ€åä¸€æ¡è§„åˆ™ç°åœ¨å·²ç»åœ¨C++17ä¸­å¾—åˆ°æ›´æ”¹ï¼Œä½†æˆ‘ä»¬ä»ç„¶æ›´å–œæ¬¢åŒ…è£…å‡½æ•°ï¼Œä¾‹å¦‚make_sharedå…·æœ‰ä¸€äº›æ€§èƒ½ä¼˜åŠ¿ç­‰ã€‚ï¼‰</p>
</li>
</ul>
<p>ä»£ç ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼1: f(expr1, expr2)</span></span><br><span class="line"><span class="built_in">f</span>( std::unique_ptr&lt;T1&gt;&#123; <span class="keyword">new</span> T1 &#125;, std::unique_ptr&lt;T2&gt;&#123; <span class="keyword">new</span> T2 &#125;);</span><br><span class="line"><span class="comment">// æ–¹å¼2ï¼šf(g(expr1), h(expr2))</span></span><br><span class="line"><span class="built_in">f</span>(std::make_unique&lt;T1&gt;(), std::make_unique&lt;T2&gt;());</span><br></pre></td></tr></table></figure>

<p>åŸºäºä»¥ä¸Šè§„åˆ™çš„ç¬¬ä¸‰æ¡ï¼Œæˆ‘ä»¬å€¾å‘äºæ€»æ˜¯ä½¿ç”¨<code>std::make_unique&lt;Node&gt;()</code>è¿™ä¸€æ–¹å¼ã€‚è¿™ä¹ˆåšçš„ç†ç”±ï¼šnewè¿”å›çš„æŒ‡é’ˆåº”è¯¥å±äºä¸€ä¸ªèµ„æºå¥æŸ„ï¼ˆå¯ä»¥è°ƒç”¨ delete ï¼‰ã€‚å¦‚æœå°†newè¿”å›çš„æŒ‡é’ˆåˆ†é…ç»™æ™®é€š/è£¸æŒ‡é’ˆï¼Œåˆ™è¯¥å¯¹è±¡å¯èƒ½ä¼šæ³„æ¼ã€‚</p>
<p>å¤‡æ³¨ï¼š<br>åœ¨å¤§å‹ç¨‹åºä¸­ï¼Œè£¸éœ²çš„ deleteï¼ˆå³åº”ç”¨ç¨‹åºä»£ç ä¸­çš„åˆ é™¤ï¼Œè€Œä¸æ˜¯ä¸“é—¨ç”¨äºèµ„æºç®¡ç†çš„ä»£ç çš„ä¸€éƒ¨åˆ†ï¼‰æ˜¯ä¸€ä¸ªå¯èƒ½çš„é”™è¯¯ï¼šå¦‚æœæ‚¨æœ‰ N ä¸ª deleteï¼Œæ‚¨å¦‚ä½•ç¡®å®šæ‚¨ä¸éœ€è¦ N +1 è¿˜æ˜¯ N-1ï¼Ÿè¯¥é”™è¯¯å¯èƒ½æ˜¯æ½œåœ¨çš„ï¼šå®ƒå¯èƒ½ä»…åœ¨ç»´æŠ¤æœŸé—´å‡ºç°ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªèµ¤è£¸è£¸çš„newï¼Œä½ å¯èƒ½éœ€è¦åœ¨æŸä¸ªåœ°æ–¹è¿›è¡Œèµ¤è£¸çš„deleteï¼Œæ‰€ä»¥ä½ å¯èƒ½æœ‰ä¸€ä¸ªé”™è¯¯ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥è­¦å‘Šä»»ä½•æ˜ç¡®çš„ new å’Œ delete ä½¿ç”¨ï¼ŒåŒæ—¶å»ºè®®ç”¨ make_uniqueã€‚</p>
<p>æ³¨æ„ï¼š<strong>åœ¨ç°ä»£C++ä¸­ï¼Œæˆ‘ä»¬å‡ ä¹ä»ä¸ä½¿ç”¨newå’Œdeleteã€‚è¿™æ ·å¯ä»¥å‡å°‘å¾ˆå¤šçš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</strong></p>
<h2 id="Lecture-17-Multithreading"><a href="#Lecture-17-Multithreading" class="headerlink" title="Lecture 17: Multithreading"></a>Lecture 17: Multithreading</h2><p>ä»£ç é€šå¸¸æ˜¯é¡ºåºçš„ï¼Œè€Œçº¿ç¨‹ï¼ˆThreadï¼‰æ˜¯å¹¶è¡Œæ‰§è¡Œä»£ç çš„æ–¹æ³•ã€‚</p>
<p>å¤šçº¿ç¨‹çš„ä¸€äº›è¦ç‚¹ï¼š</p>
<ul>
<li>å¦‚æœè¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œè¯·ä½¿ç”¨åŸå­ç±»å‹ï¼ˆè¯¦ç»†å‚è§<code>&lt;atomic&gt;</code>åº“ï¼‰ã€‚</li>
<li><code>std:: lock guard</code> vs. <code>std:: unique_lock</code></li>
<li>å¸¸ç”¨çš„3ç§ç±»å‹çš„â€œé”â€/äº’æ–¥é”ï¼šæ™®é€šï¼ˆnormalï¼‰ã€å®šæ—¶ï¼ˆtimedï¼‰ã€é€’å½’ï¼ˆrecursiveï¼‰ï¼ˆè¯¦ç»†å‚è§<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/thread">é“¾æ¥</a>ï¼‰ã€‚</li>
<li>æ¡ä»¶å˜é‡ï¼ˆCondition variablesï¼‰å…è®¸è·¨çº¿ç¨‹é€šä¿¡ï¼ˆè¯¦ç»†å‚è§<a href="%5B%5D(https://en.cppreference.com/w/cpp/header/condition_variable)">é“¾æ¥</a>ï¼‰ã€‚</li>
<li><code>std::async</code>æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹çš„ä¸€ç§æ–¹å¼</li>
</ul>
<p>ä¸€ä¸ªä»£ç ä¾‹å­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::cout;</span><br><span class="line"><span class="keyword">using</span> std::endl;</span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="keyword">using</span> std::vector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">size_t</span> kNumThreads = <span class="number">10</span>;</span><br><span class="line">std::mutex mtx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">greet</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// make the entire function atomic</span></span><br><span class="line">    <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lg</span><span class="params">(mtx)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Hello there! My name is &quot;</span> &lt;&lt; id &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Greetings from my threads...&quot;</span> &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    vector&lt;std::thread&gt; threads;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i=<span class="number">0</span>; i &lt; kNumThreads; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">push_back</span>(std::<span class="built_in">thread</span>(greet, i));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// wait for thread1 and thread2 to finish</span></span><br><span class="line">	<span class="keyword">for</span> (std::thread&amp; t : threads) &#123;</span><br><span class="line">        t.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;All greetings done!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Further-C-reading"><a href="#Further-C-reading" class="headerlink" title="Further C++ reading"></a>Further C++ reading</h2><table>
<thead>
<tr>
<th>ä¹¦å</th>
<th>ä½œè€…</th>
</tr>
</thead>
<tbody><tr>
<td>Accelerated C++</td>
<td>Andrew Koenig</td>
</tr>
<tr>
<td>Effective C++</td>
<td>Scott Meyers</td>
</tr>
<tr>
<td>Effective Modern C++</td>
<td>Scott Meyers</td>
</tr>
<tr>
<td>Exceptional C++</td>
<td>Herb Sutter</td>
</tr>
<tr>
<td>Modern C++ Design</td>
<td>Andrei Alexandrescu</td>
</tr>
<tr>
<td>C++ Template Metaprogramming</td>
<td>Abrahams and Gurtovoy</td>
</tr>
<tr>
<td>C++ Concurrency in Action</td>
<td>Anthony Williams</td>
</tr>
</tbody></table>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å­¦å®Œè¿™é—¨ä¹‹åï¼Œä¸ªäººæ„Ÿè§‰C++çš„å†…å®¹ç¡®å®å¤ªå¤šäº†ï¼Œè€Œä¸”æœ€è¿‘æ²¡è¿‡å‡ å¹´ï¼Œè¿˜ä¼šå¼€ä¼šå»ç¡®å®šæ–°æ ‡å‡†ï¼Œå¼•å…¥æ–°ç‰¹æ€§ï¼Œè¿™å¯èƒ½ä¹Ÿç®—æ˜¯ä¸æ—¶ä¿±è¿›å§ã€‚è¯¾ç¨‹æ˜¯çŸ­æœŸå†…çœ‹å®Œäº†ï¼Œè€Œä¸”ä¹ŸçŸ¥é“å¦‚ä½•å»çœ‹æ–‡æ¡£å’Œå­¦ä¹ ç›¸å…³çš„æ–°ç‰¹æ€§äº†ã€‚åç»­å°±æ˜¯éœ€è¦å¤šç”¨å¤šå†™ï¼Œæ¥åŠ æ·±å¯¹C++çš„ç†è§£ã€‚</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-10-Classes-and-Constant"><span class="toc-number">1.</span> <span class="toc-text">Lecture 10: Classes and Constant</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%A6%82%E8%A7%88"><span class="toc-number">1.1.</span> <span class="toc-text">é¢å‘å¯¹è±¡æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-%E5%8F%98%E9%87%8F"><span class="toc-number">1.2.</span> <span class="toc-text">const-å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-%E6%8C%87%E9%92%88"><span class="toc-number">1.3.</span> <span class="toc-text">const-æŒ‡é’ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text">const-è¿­ä»£å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const%E5%9B%9E%E9%A1%BE"><span class="toc-number">1.5.</span> <span class="toc-text">constå›é¡¾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-11-Operators"><span class="toc-number">2.</span> <span class="toc-text">Lecture 11: Operators</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD%E7%9A%84%E4%B8%80%E8%88%AC%E7%BB%8F%E9%AA%8C%E6%B3%95%E5%88%99"><span class="toc-number">2.1.</span> <span class="toc-text">é‡è½½çš„ä¸€èˆ¬ç»éªŒæ³•åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Principle-of-Least-Astonishment-POLA"><span class="toc-number">2.2.</span> <span class="toc-text">Principle of Least Astonishment(POLA)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-12-Special-Member-Functions"><span class="toc-number">3.</span> <span class="toc-text">Lecture 12: Special Member Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">3.0.1.</span> <span class="toc-text">æ„é€ å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-operations"><span class="toc-number">3.1.</span> <span class="toc-text">copy operations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-elision%E5%92%8CRVO%EF%BC%88return-value-optimization%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">copy elisionå’ŒRVOï¼ˆreturn value optimizationï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-13-Move-Semantics"><span class="toc-number">4.</span> <span class="toc-text">Lecture 13: Move Semantics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#std-vector-lt-T-Allocator-gt-emplace-back"><span class="toc-number">4.1.</span> <span class="toc-text">std: :vector&lt;T,Allocator&gt;: :emplace_back</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lvalues-and-rvalues"><span class="toc-number">4.2.</span> <span class="toc-text">lvalues and rvalues</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#move-operations-c-11"><span class="toc-number">4.3.</span> <span class="toc-text">move operations(c++11)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-14-Inheritance"><span class="toc-number">5.</span> <span class="toc-text">Lecture 14: Inheritance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Namespaces"><span class="toc-number">5.1.</span> <span class="toc-text">Namespaces</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Inheritance"><span class="toc-number">5.2.</span> <span class="toc-text">Inheritance</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-15-Inheritance-and-Template"><span class="toc-number">6.</span> <span class="toc-text">Lecture 15: Inheritance and Template</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Classes"><span class="toc-number">6.1.</span> <span class="toc-text">Classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Templates-vs-Derived-Classes"><span class="toc-number">6.2.</span> <span class="toc-text">Templates vs Derived Classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Template-Classes"><span class="toc-number">6.3.</span> <span class="toc-text">Template Classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Concepts-and-Constraints-C-20-%E5%A4%8D%E4%B9%A0"><span class="toc-number">6.4.</span> <span class="toc-text">Concepts and Constraints(C++20)å¤ä¹ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-16-RAII-and-Smart-Pointers"><span class="toc-number">7.</span> <span class="toc-text">Lecture 16: RAII and Smart Pointers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%BC%95"><span class="toc-number">7.1.</span> <span class="toc-text">å¯¼å¼•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RAII"><span class="toc-number">7.2.</span> <span class="toc-text">RAII</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Smart-Pointers"><span class="toc-number">7.3.</span> <span class="toc-text">Smart Pointers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lecture-17-Multithreading"><span class="toc-number">8.</span> <span class="toc-text">Lecture 17: Multithreading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Further-C-reading"><span class="toc-number">9.</span> <span class="toc-text">Further C++ reading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">10.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&text=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&is_video=false&description=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†&body=Check out this article: https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&title=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&name=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://crownz-sec.github.io/2022/07/31/Stanford%20CS106L%202019%20Note-Second%20half/&t=Stanford CS106L ç¬”è®°â€”â€”ä¸‹åŠéƒ¨åˆ†"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2022
    crownZ
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'crownZz';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
